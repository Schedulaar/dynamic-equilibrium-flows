\section{Schmale Flüsse mit Zurücksetzen}\label{sec-thin-flows}
\newcommand*{\PlH}{\makebox[1ex]{\textbf{$\cdot$}}}

Der Abschnitt beginnt mit der Einführung einer neuen Klasse statischer Flüsse:

\begin{definition}[$s$-Fluss]
	Ein $b$-Fluss $f$ in einem Graphen $(V, E)$ heißt \emph{$s$-Fluss} für ein $s\in V$, falls $b_v\leq 0$ für alle $v\in V\setminus \{ s \}$ gilt.
	Dabei bezeichnet $b_s$ den \emph{Wert von $f$}. 
\end{definition}

\begin{definition}[Netzwerk mit Zurücksetzen]
	Ein \emph{Netzwerk mit Zurücksetzen auf $E_1$ und Ursprung $s$} ist ein Tupel $(V, E, u, s, E_1)$, wobei $(V, E, u)$ ein azyklisches Netzwerk ist, in dem der Knoten $s\in V$ jeden anderen Knoten erreicht, und $E_1\subseteq E$ die Menge der \emph{zurücksetzenden Kanten} ist.
\end{definition}

\begin{definition}[Auslastung]
	Sei ein $s$-Fluss $f$ in einem Netzwerk mit Zurücksetzen auf $E_1$ und Ursprung $s$ gegeben.
	Dann ist die \emph{Auslastung einer Kante} gegeben durch $f_e/u_e$.
	Die \emph{Auslastungsübertragung einer Kante $vw$} sei gegeben durch \[ \rho_{vw}(l_v, f_{vw}) := \begin{cases}
		\max\{ l_v, f_{vw} / u_{vw} \}, & \text{falls $vw\notin E_1$,}\\
		f_{vw} / u_{vw}, & \text{falls $vw\in E_1$.}
	\end{cases}
	\]
	Die \emph{Auslastung eines $s$-$v$-Pfades $P=(e_1,\dots,e_k)$} ist dann gegeben durch die Verkettung $(\rho_{e_k}(\PlH, f_{e_k})\circ \dots \circ \rho_{e_1}(\PlH, f_{e_1}))(0)$.
	Die zu $f$ \emph{zugehörige Knotenauslastung $l\in\R_{\geq 0}^V$} sei dann für einen Knoten $v\in V$ festgelegt durch die minimale Auslastung eines $s$-$v$-Pfades.
\end{definition}

Betrachtet man einen $s$-$v$-Pfad $P=(e_1, \dots, e_k)$, der Kanten aus $E_1$ enthält, so ist die Auslastung von $P$ gerade $\max_{j=i}^k f_{e_j}/u_{e_j}$, wobei $e_i$ die letzte Kante des Pfades in $E_1$ ist.
Daher nennt man die Kanten in $E_1$ die zurücksetzenden Kanten, da sie die Auslastung eines vorangegangen Pfades auf ihre eigene zurücksetzen.

\begin{proposition}\label{prop-congestion-labels-dijkstra}
	Die Knotenauslastungen eines $s$-Flusses $f$ sind gegeben durch die eindeutige Lösung $(\tilde{l}_v)_{v\in V}$ des Gleichungssystems
	\[
	\tilde{l}_w = \begin{cases}
		0, & \text{falls $w=s$,}\\
		\min_{vw\in \delta^-(w)} \rho_{vw}(\tilde{l}_v, f_{vw}), & \text{sonst.}
	\end{cases}
	\]
\end{proposition}
\begin{proof}
	Die Existenz einer Lösung folgt aus der Azyklizität des Netzwerks und wegen der Erreichbarkeit jedes Knotens von $s$ aus.
	
	Sei also $\tilde{l}\in\R_{\geq 0}^V$ die Lösung des Gleichungssystems.
	Der Teilgraph $(V, E')$ mit \[
	E':= \{ e\in E \mid \rho_{vw}(\tilde{l}_v, f_{vw}) = \min_{uw\in\delta^-(w)}  \rho_{uw}(\tilde{l}_u, f_{uw}) \}
	\]
	ebenfalls azyklisch und jeder Knoten ist von $s$ aus erreichbar.
	Man zeige $l_w = \tilde{l}_w$ durch eine Induktion über die Distanz von $w$ zu $s$ bezüglich der Anzahl an Kanten.
	Für $w=s$ gilt offenbar $l_s = 0$.
	Sei nun ein $s$-$w$-Pfad $P$ gegeben, seien $vw$ die letzte Kante und $Q$ das restliche Anfangsstück dieses Pfades.
	Nach Induktionsvoraussetzung ist die Auslastung von $Q$ mindestens $\tilde{l}_v$.
	Daher ist die Auslastung von $P$ mindestens $\rho_{vw}(\tilde{l}_v, f_{vw})$ aufgrund der Monotonie von $\rho_{vw}(\PlH, f_{vw})$, wodurch $l_v \geq \tilde{l}_v$ folgt.
	Außerdem hat ein $s$-$v$-Pfad $P$, der in $(V, E')$ verläuft, hat Auslastung $\tilde{l}_v$.
	Da solch ein Pfad existiert, gilt also $l_v \leq \tilde{l}_v$.
\end{proof}

\begin{definition}[Schmaler Fluss]
	Seien ein $s$-Fluss $f$ in einem Netzwerk mit Zurück\-setzen auf $E_1$ und Ursprung $s$ sowie die durch $f$ induzierten Knotenauslastungen $l$ gegeben.
	Der Fluss $f$ heißt \emph{schmaler Fluss mit Zurücksetzen auf $E_1$}, falls die Auslastung jedes $s$-$v$-Pfades mit positivem Fluss $l_v$ beträgt. 
\end{definition}

Insbesondere ist bei einem schmalen Fluss die Knotenauslastung $l_v$ eines Knotens $v$ gerade die Auslastung eines jeden $s$-$v$-Pfades mit positivem Fluss und $0$, falls kein solcher existiert.

\begin{remark}
	Ronald Koch betrachtet in~\cite{Koch2012} allgemeinere schmale Flüsse: Dort ist das zugrundeliegende Netzwerk nicht als azyklisch vorausgesetzt.
	Diese Einschränkung wird hier im Sinne von~\cite{Cominetti2015} beibehalten.
\end{remark}

\begin{lemma}\label{lemma-thin-flow-t-def}
	Ein $s$-Fluss $f$ in einem Netzwerk mit Zurücksetzen auf $E_1$ und Ursprung $s$ ist genau dann ein schmaler Fluss mit Zurücksetzen auf $E_1$, wenn eine Knotenbewertung $l\in\R_{\geq 0}^V$ existiert, die die folgenden Bedingungen erfüllt:
	\begin{enumerate}[label=(T\arabic*)]
		\item\label{def-thin-flow-source} $l_s = 0$,
		\item\label{def-thin-flow-x-zero} $l_w \leq l_v$, \tabto{4.5cm} für $vw\in E \setminus E_1$ mit $f_{vw}=0$,
		\item\label{def-thin-flow-x-positive} $l_w = \max\{ l_v, f_{vw} / u_{vw} \}$,  \tabto{4.5cm} für $vw\in E\setminus E_1$ mit $f_{vw} > 0$,
		\item\label{def-thin-flow-resetting-edge} $l_w = f_{vw} / u_{vw}$,  \tabto{4.5cm} für $vw\in E_1$,
		\item\label{def-thin-flow-no-resetting-edge} $l_w \geq \min_{vw\in \delta^-(w)} l_v$, \tabto{4.5cm} falls $\delta^-(w)\cap E_1 = \emptyset$.
	\end{enumerate}
	Diese Knotenbewertung stimmt dann mit der Knotenauslastung von $f$ überein.
	Außerdem gelten die Bedingungen~\ref{def-thin-flow-source}, \ref{def-thin-flow-x-zero} und~\ref{def-thin-flow-no-resetting-edge} bereits für die Knotenauslastungen von $f$, falls $f$ nur ein $s$-Fluss ist.
\end{lemma}
\begin{proof}
	Sei $f$ ein schmaler Fluss mit Zurücksetzen auf $E_1$ und sei $l\in\R_{\geq 0}^V$ die Knotenauslastung von $f$.
	Man zeige, dass $l$ die Bedingungen~\ref{def-thin-flow-source}-\ref{def-thin-flow-no-resetting-edge} erfüllt, und benutze dabei die Darstellung aus Proposition~\ref{prop-congestion-labels-dijkstra}.
	Wegen $l_s = 0$ gilt bereits~\ref{def-thin-flow-source}.
	Für eine Kante $vw\in E\setminus E_1$ mit $f_{vw}=0$ gilt $l_w\leq \rho_{vw}(l_v, f_{vw}) = l_v$, wodurch auch~\ref{def-thin-flow-x-zero} folgt.
	Ist $vw\in E$ mit $f_{vw} > 0$, so existiert ein $s$-$w$-Pfad mit positivem Fluss, der die Kante $vw$ benutzt, sodass die Auslastung dieses Pfades $l_w=\rho_{vw}(l_v, f_{vw})$ ist, da der $s$-$v$-Teilpfad die Auslastung $l_v$ besitzt.
	Für $vw\notin E_1$ bedeutet das gerade $l_w = \max\{ l_v, f_{vw}/u_{vw} \}$ also~\ref{def-thin-flow-x-positive}, und für $vw\in E_1$ zeigt das $l_w = f_{vw} / u_{vw}$.
	Für~\ref{def-thin-flow-resetting-edge} bleibt der Fall $f_{vw} = 0$ zu prüfen:
	Dann ist aber $l_w = \min_{uw\in\delta^-(w)} \rho_{uw}(l_u, f_{uw}) = f_{vw} / u_{vw} = 0$.
	Zuletzt betrachte man den Fall, dass $w$ keine eingehende zurücksetzende Kante hat.
	Dann folgt aber bereits $l_w = \min_{vw\in \delta^-(w)} \max\{ l_v, f_{vw} / u_{vw} \} \geq \min_{vw\in\delta^-(w)} l_v$, was auch~\ref{def-thin-flow-no-resetting-edge} impliziert.
	
	Sei nun umgekehrt $l\in\R_{\geq 0}^V$ eine Knotenbewertung, die~\ref{def-thin-flow-source}-\ref{def-thin-flow-no-resetting-edge} erfüllt.
	Man verwende eine Induktion über die Distanz eines Knotens $w$ zu $s$ bezüglich der Kantenzahl, um zu zeigen, dass $l_w$ die Knotenauslastung von  $f$ ist.
	Für $w=s$ gilt $l_s=0$ bereits nach~\ref{def-thin-flow-source}.
	Für $w\neq s$ ist $l_w$ nach~\ref{def-thin-flow-x-zero},~\ref{def-thin-flow-x-positive} und~\ref{def-thin-flow-resetting-edge} eine untere Schranke an $\rho_{vw}(l_v, f_{vw})$ für $vw\in\delta^-(w)$.
	Es bleibt zu zeigen, dass für eine eingehende Kante $vw$ der Wert $\rho_{vw}(l_v, f_{vw})$ auch $l_w$ annimmt:
	Falls eine eingehende Kante $vw\in E_1$ oder eine eingehende Kante $vw$ mit $f_{vw} > 0$ existiert, ist $\rho_{vw}(l_v, f_{vw}) = l_w$ nach~\ref{def-thin-flow-resetting-edge} und~\ref{def-thin-flow-x-positive}.
	Sonst ist $l_w\geq \min_{vw\in \delta^-(w)} l_v = \min_{vw\in \delta^-(w)} \rho_{vw}(l_v', x_{vw}')$ nach~\ref{def-thin-flow-no-resetting-edge}, was die Behauptung zeigt.
	Um zu sehen, dass $f$ nun ein schmaler Fluss mit Zurücksetzen auf $E_1$ ist, genügen die Bedingungen~\ref{def-thin-flow-source}, \ref{def-thin-flow-x-positive} und~\ref{def-thin-flow-resetting-edge}, da dadurch jeder $s$-$v$-Teilpfad eines Pfades mit positivem Fluss gerade Auslastung $l_v$ hat.
\end{proof}

\begin{remark}\label{remark-thin-flow}
	Hier ist, wie in~\cite[Definition~4]{Cominetti2011}, im Vergleich zu~\cite[Definition~6]{Koch2011} die Bedingung~\ref{def-thin-flow-no-resetting-edge} zusätzlich eingeführt worden.
	Diese ist nötig, um im Beweis von Theorem~\ref{thm-alpha-extension-is-nash-flow} zu zeigen, dass die erweiterten Ankunftszeiten tatsächlich mit den angegebenen übereinstimmen.
	Ohne diese Bedingung würde dies nämlich nicht gelten, wie man in Abbildung~\ref{figure-labels} erkennen kann.
\end{remark}
\todo{
	Introduce network inflow with normalized thin-flows
	\begin{definition}[Schmaler Fluss]\label{def-thin-flow}
		Der Fluss $x'$ heißt \emph{normiert}, falls $F=d$ gilt.
		Ist $E_1$ nichtleer, so heißt $x'$ \emph{schmaler Fluss mit Zurücksetzen auf $E_1$}, sonst heißt $x'$ \emph{schmaler Fluss ohne Zurücksetzen}.
	\end{definition}
}

\begin{lemma}\label{lemma-equivalent-thin-flow}
	Ein $s$-Fluss $f$ ist genau dann ein schmaler Fluss mit Zurück\-setzen auf $E_1$, wenn $f_{vw}= 0$ für alle $vw\in E$ mit $l_w < \rho_{vw}(l_v, f_{vw})$ gilt.
	Dabei sei $l\in\R_{\geq 0}^V$ die Knotenauslastung von $f$.
\end{lemma}
\begin{proof}
	Angenommen, $f$ sei ein schmaler Fluss mit Zurücksetzen auf $E_1$.
	Für eine Kante $vw\in E$ mit $l_w < \rho_{vw}(l_v, f_{vw})$ ist $vw\notin E_1$ und $f_{vw}=0$ nach~\ref{def-thin-flow-resetting-edge} und~\ref{def-thin-flow-x-positive}.

	Nun nehme man an, es gelte $f_{vw}=0$ für alle $vw\in E$ mit $l_w < \rho_{vw}(l_v, f_{vw})$, und man zeige die Eigenschaften~\ref{def-thin-flow-x-positive} und \ref{def-thin-flow-resetting-edge}.
	Der Rest folgt dann mit Lemma~\ref{lemma-thin-flow-t-def}.
	Ist $vw\notin E_1$ mit $f_{vw}>0$, so gilt $l_w = \rho_{vw}(l_v, f_{vw})$, wodurch Bedingung~\ref{def-thin-flow-x-positive} folgt.
	Für~\ref{def-thin-flow-resetting-edge} betrachte man zunächst $vw\in E_1$ mit $f_{vw}>0$: Hier folgt wieder $l_w = \rho_{vw}(l_v, f_{vw})$.
	Falls $f_{vw}=0$ gilt, ist $l_w=\min_{\tilde{v}w\in \delta^-(w)} \rho_{\tilde{v}w}(l_{\tilde{v}}, f_{\tilde{v}w}) = 0$.
\end{proof}

\todo{Vlt im folgenden Korollar auch/oder Gleichheit zu $\max f_e/u_e$ zeigen}
\begin{corollary}\label{cor-thin-flows-max-node-label-equals-max-edge-label}
	Für einen schmalen $s$-Fluss $f$ in einem Netzwerk mit nichtleerer Kantenmenge und zugehöriger Knotenauslastung $l$ gilt
	\[
		\max_{vw\in E} \rho_{vw}(l_v, f_{vw}) = \max_{v\in V} l_v
	\]
\end{corollary}
\begin{proof}
	Für $w\neq s$ ist $l_w = \min_{vw\in\delta^-(w)} \rho_{vw}(l_v, x_{vw})$.
	Daher gilt bereits \glqq$\geq$\grqq.
	Angenommen es gebe eine Kante $vw\in E$ mit $\rho_{vw}(l_v, f_{vw}) > \max_{u\in V} l_u$
	Dann ist aber bereits $f_{vw}/u_{vw} > \max_{u\in V} l_u \geq 0$, womit $l_w \geq \rho_{vw}(l_v, f_{vw})$ nach Lemma~\ref{lemma-equivalent-thin-flow} gelten müsste.
\end{proof}

\begin{lemma}[Eindeutigkeit der Knotenbewertung]
	Seien ein azyklisches Netzwerk mit Ursprung $s$ und Versorgungsrate $d\in\R_{\geq 0}$ sowie $E_1\subseteq E$ gegeben.
	Dann sind die Knotenbewertungen aller normierter schmaler Flüsse mit Zurücksetzen auf $E_1$ identisch.
\end{lemma}
\begin{proof}
	Angenommen, es existieren zwei normierte schmale Flüsse $x'$ und $y'$ mit Zurück\-setzen auf $E_1$ mit unterschiedlichen Knotenbewertungen $l'\neq h'$.
	Dann ist oBdA. die Menge $S:=\{ v\in V \mid l_v' > h_v' \}$ nichtleer.
	Der Balancevektor $(b_v)_{v\in V}$ mit $$b_v:=\sum_{e\in\delta^+(v)} x_e' - \sum_{e\in\delta^-(s)} x_e' = \sum_{e\in\delta^+(v)} y_e' - \sum_{e\in\delta^-(v)} y_e'$$ ist für $x'$ und $y'$ identisch, da beide Flusserhaltung in $v\notin\{ s, t\}$, und damit $b_v=0$ erfüllen und Wert $d$ besitzen.
	Betrachtet man Kanten, die innerhalb $S$ verlaufen, erhält man 
	\begin{equation}\label{proof-uniqueness-labels-eq}
	\sum_{e\in \delta^+(S)} x'_e - \sum_{e\in\delta^-(S)} x'_e = \sum_{v\in S} b_v = \sum_{e\in\delta^+(S)} y_e' - \sum_{e\in\delta^-(S)} y_e'.
	\end{equation}
	Für Kanten $vw\in \delta^+(S)$ gilt $x_e' \leq y_e'$, da für $x_e' > y_e'$ Lemma~\ref{lemma-equivalent-thin-flow} und $v\in S$ die Ungleichung $l_w' = \rho_{vw}(l_v', x_{vw}') > \rho_{vw}(h_v', y_{vw}')\geq h_w'$ implizieren würden, welche jedoch im Widerspruch zu $w\notin S$ steht.
	Ebenso gilt für Kanten $vw\in\delta^-(S)$ die Ungleichung $x_e' \geq y_e'$, weil sonst $l_w' \leq \rho_{vw}(l_v', x_{vw}') \leq \rho_{vw}(h_v', y_{vw}') = h_w'$ wegen $v\notin S$ gelten würde, was $w\in S$ widerspricht.
	Gleichung~\ref{proof-uniqueness-labels-eq} impliziert dann sogar $x_e = y_e$ für alle $e\in \delta(S):=\delta^-(S) \cup \delta^+(S)$.
	Für $vw\in \delta^-(S)$ ist dann $y_e'=x_e'=0$, da für $y_e'=x_e'>0$ wieder mit $v\notin S$ die Ungleichung $l_w' = \rho_{vw}(l_v, x_{vw}')\leq \rho_{vw}(h_v, y_{vw}')=h_w'$ der Bedingung $w\in S$ widerspricht.
	
	Aufgrund der Azyklizität existiert ein Knoten $w\in S$ mit $\delta^-(w)\subseteq \delta^-(S)$.
	Eingehende Kanten von $w$ sind daher nicht in $E_1$ enthalten, da für solch eine Kante $\rho_{vw}(l_v', x_e') = 0 = \rho_{vw}(l_v', y_e')$ gelten würde, sodass $l_w' = 0 = h_w'$ der Voraussetzung $w\in S$ widerspricht.
	Daher ist $l_w' = \min_{vw\in \delta^-(w)} l_v'$ und $h_w' = \min_{vw\in\delta^-(w)} h_v'$, was den Widerspruch $l_w' \leq h_w'$ impliziert.
\end{proof}

\begin{theorem}[Existenz eines normierten schmalen Flusses]\label{thm-existence-thin-flow}
	Seien ein azyklisches Netzwerk $(G,u,s,t)$ mit Ursprung $s$ und Versorgungsrate $d\in\R_{\geq 0}$ sowie $E_1\subseteq E$ gegeben.
	Es existiert ein normierter schmaler Fluss mit Zurücksetzen auf $E_1$.
\end{theorem}

Um die Existenz zu beweisen, benötigen wir zunächst den Fixpunktsatz von Kakutani.
Dazu führen wir die folgenden Begriffe ein:

\begin{definition}[Korrespondenz, Fixpunkt]
	Eine \emph{Korrespondenz} von einer Menge $A$ in eine Menge $B$ ist eine Abbildung $f: A \to \mathcal{P}(B)\setminus \{ \emptyset \}$ von $A$ in die Potenzmenge von $B$ ohne die leere Menge.
	Sind $A$ und $B$ topologische Räume, so nennt man $f$ \emph{abgeschlossen}, wenn die zugehörige Relation $R_f := \{ (a,b) \in A\times B \mid b\in f(a)  \}$ in der Produkttopologie abgeschlossen ist.

	Ein \emph{Fixpunkt} einer Korrespondenz $f: X \to \mathcal{P}$ ist ein Punkt $x\in X$ mit $x\in f(x)$.
\end{definition}

Nun lautet der Fixpunktsatz von Kakutani (siehe~\cite{Heuser1991Fix}):

\begin{satz}[Fixpunktsatz von Kakutani]\label{satz-kakutani}
	Seien $C\subseteq E$ eine nichtleere, konvexe und kompakte Teilmenge eines normierten Raumes $E$ und $f: C \to \mathcal{P}(C)$ eine abgeschlossene, konvexwertige Korrespondenz.
	Dann besitzt $f$ einen Fixpunkt.
\end{satz}

\begin{proof}[Beweis von Theorem~\ref{thm-existence-thin-flow}]
	Man betrachte die Menge $C$ aller $s$-$t$-Flüsse mit Wert $d$ als Teilmenge des metrischen Raums $\R^E$.
	Diese ist nichtleer, weil $t$ von $s$ aus erreichbar ist, konvex, da für $x', y'\in C, \lambda \in [0,1]$ der Fluss $\lambda x' + (1-\lambda)y'$ wieder die Flusserhaltung erfüllt, und kompakt, da jeder Fluss in $C$ von Wert $d$ ist und aufgrund der Azyklizität in $s$-$t$-Wege zerlegbar ist, wodurch jede Kante maximal Fluss $d$ besitzen kann, sodass $C\subseteq [0, d]^E$ folgt.
	Auf $C$ definiere man die Korrespondenz
	\[
	\Gamma: C\to \mathcal{P}(C)\setminus\{ \emptyset \}, ~ x'\mapsto \{ y'\in C \mid \forall vw\in E: l_w' < \rho_{vw}(l_v', x_{vw}') \implies y_{vw}' = 0 \}.
	\]
	Dabei sei $l'\in\R_{\geq 0}^V$ die zu $x'$ gehörige Knotenauslastung.
	Diese Korrespondenz ist wohldefiniert, da $\Gamma(x')$ für jedes $x'\in C$ nichtleer ist:
	Der Knoten $s$ kann im Graphen $G':= (V, E')$ mit $E':= \{ vw\in E \mid \rho_{vw}(l_v', x_{vw}')=l_w' \}$ jeden Knoten erreichen, da $G'$ azyklisch ist und jeder Knoten $w\neq s$ hat mindestens eine eingehende Kante mit $l_w' = \rho_{vw}(l_v', x_{vw}')$ besitzt. 
	Daher existiert ein $s$-$t$-Weg $P$ in $G'$ und der Fluss $d\cdot P$ ist in $\Gamma(x')$ enthalten.
	
	Für jedes $x'\in C$ ist $\Gamma(x')$ konvex: Ist für $y', z'\in \Gamma(x'), \lambda\in [0,1]$ und eine Kante $vw\in E$ die Bedingung $l_w' < \rho_{vw}(l_w', x_{vw}')$ erfüllt, so gilt auch $\lambda y_{vw}' + (1-\lambda) z_{vw}' = 0$, womit $\lambda y' + (1-\lambda)z'$ im Bild $\Gamma(x)$ liegt.
	Des Weiteren ist $\Gamma$ abgeschlossen: 
	Sei eine konvergente Folge $((x^{n}, y^{n}))_{n\in\N}$ in $R_\Gamma$ mit Grenzwert $(x, y)$ gegeben.
	Die zu $x$ bzw. $x^n$ gehörigen Knotenauslastungen seien gegeben durch $l$ bzw. $l^n$. 
	Angenommen, es gelte $l_w < \rho_{vw}(l_v, x_{vw})$.
	Da die Zuordnung $x'\mapsto l'$ eines $s$-Flusses auf seine Knotenauslastung nach Lemma~\ref{prop-congestion-labels-dijkstra} stetig ist, existiert ein $N\in\N$ mit $l_w^n<\rho_{vw}(l_v^n, x_{vw}^n)$ für alle $n\geq N$.
	Damit ist auch $y_{vw} = \lim_{n\to\infty} y_{vw}^n = 0$.
	
	Daher existiert nach dem Fixpunktsatz von Kakutani~\ref{satz-kakutani} ein Fixpunkt von $\Gamma$, welcher nach Lemma~\ref{lemma-equivalent-thin-flow} ein normierter schmaler Fluss mit Zurücksetzen auf $E_1$ ist.
\end{proof}

\section{Effiziente Berechnung schmaler Flüsse}

Die Existenz schmaler Flüsse mit Zurücksetzen aus Theorem~\ref{thm-existence-thin-flow} suggeriert bereits einen exponentiellen Algorithmus, um einen solchen Fluss mit Wert $d$ zu berechnen:
Man rate die Menge $E'\subseteq E$ aller Kanten $vw$, die $l_w' = \rho_{vw}(l_v', x_{vw}')$ erfüllen, sowie für alle $vw\in E'\setminus E_1$ eine Binärzahl $\sigma_{vw}\in\{0,1\}$, die $\max\{ l_v', x_{vw}/u_{vw}\} = \sigma_{vw} l_v' + (1-\sigma_{vw}) x_{vw}/u_{vw}$ erfüllt.
Dann suche man einen zulässigen Punkt in folgendem Polyeder:
\begin{align*}
&	(x', l') \in \R_{\geq 0}^{E'\times V} \\
	\text{u.d.N.}\quad &
	x'(\delta^+(v)) - x'(\delta^-(v)) =
		\begin{cases}
			d, & \text{falls $v=s$},\\
			0, & \text{sonst,} 
		\end{cases} & \text{für $v\in V\setminus\{t \}$,} \\
	& \begin{array}{@{}l}
		l_w' = \sigma_{vw} l_v' + (1-\sigma_{vw}) x'_{vw}/u_{vw}\\
		\sigma_{vw} l_v' + (1-\sigma_{vw}) x'_{vw}/u_{vw} \geq x'_{vw}/u_{vw}\\
		\sigma_{vw} l_v' + (1-\sigma_{vw}) x'_{vw}/u_{vw} \geq l_v'
	\end{array}
	& \text{für $vw\in E'\setminus E_1$},\\
	& l_w' = x'_{vw}/u_{vw} & \text{für $vw\in E_1$.}
\end{align*}

\newcommand{\TFNP}{\mathbf{TFNP}}

Existiert solch ein Punkt $(x', l')$, so ist $x'$ nach Lemma~\ref{lemma-equivalent-thin-flow} ein schmaler Fluss mit Zurücksetzen auf $E_1$ mit zugehöriger Knotenbewertung $l'$.
Außerdem muss aufgrund der Existenz eines schmalen Flusses mindestens eine Wahl von $E'$ und $\sigma$ existieren, sodass der zugehörige Polyeder nichtleer ist.
\todo{Habe ich hier nicht das Problem, dass ich das nur für $\Q$ in polynomieller Zeit berechnen kann?}
Die Zulässigkeit eines solchen Polyeders kann in polynomieller Zeit beispielsweise durch die Ellipsoidmethode ermittelt werden. 
Daher liegt das Problem, zu einem Netzwerk $(V, E, u, s, t)$ einen schmalen $d$-Fluss mit Zurücksetzen auf $E_1\subseteq E$ zu finden, in der Komplexitätsklasse $\TFNP$:

\begin{definition}[Komplexitätsklasse $\TFNP$]
	Eine Relation $P(x,y)$ liegt in der Komplexitätsklasse $\TFNP$ genau dann, wenn es einen deterministischen, polynomiellen Algorithmus gibt, der entscheidet, ob $P(x,y)$ für zwei Kandidaten $x$ und $y$ gilt, und wenn für alle $x$ ein Kandidat $y$ existiert, dessen Kodierung polynomielle Größe in der Kodierungslänge von $x$ besitzt, sodass $P(x, y)$ gilt.
\end{definition}

In diesem Abschnitt wird ein polynomieller Algorithmus zur Berechnung von schmalen Flüssen ohne Zurücksetzen vorgestellt.
Dazu werden zunächst einige Begriffe eingeführt:

\begin{definition}[Schnitt]
	In einem gerichteten Netzwerk $(V, E, u)$ heißt eine Teilmenge $X\subseteq V$ \emph{Schnitt}, wobei die aus $X$ ausgehenden Kanten mit $\delta^+(X)$ und die in $X$ eingehenden Kanten mit $\delta^-(X)$ bezeichnet werden.
	
	Sind zusätzlich Knotenbalancen $b\in\R^V$ mit $\sum_{v\in V} b_v = 0$ gegeben und ist $\delta^+(X)$ nichtleer, so bezeichne $b(X) / u(\delta^+(X))$ die \emph{Auslastung des Schnittes $X$}.
	Dabei ist $b(X)$ bzw. $u(E')$ eine Kurzschreibweise für $\sum_{v\in X} b_v$ bzw. $\sum_{e\in E'} u_e$.
	Existiert ein Schnitt, dessen Auslastung maximal ist, so nennt man ihn einen \emph{dünnsten Schnitt}.
\end{definition}
Man bemerke, dass ein dünnster Schnitt existiert, wenn die Kantenmenge $E$ nichtleer ist.
\begin{definition}[Auslastung eines $b$-Flusses]
	In einem Netzwerk $(V, E, u)$ nennt man die maximale Kantenauslastung $\max_{e\in E} f_e / u_e$ die \emph{Auslastung des $b$-Flusses $f$}.
\end{definition}

\begin{lemma}
	\todo{Ein kantenminimaler b-Fluss kann in $O(xyz)$ Zeit gefunden werden}
\end{lemma}

\begin{lemma}\label{lemma-no-circle-in-res-graph-inclus-min}
	Sei $q^*$ die minimale Auslastung eines $b$-Flusses im Netzwerk $(V, E, u)$.
	Ist $E'\subseteq E$ inklusionsminimal mit der Eigenschaft, dass ein $b$-Fluss $f$ minimaler Auslastung existiert, sodass $E'$ die durch $f$ maximal ausgelasteten Kanten sind, so enthält der Residualgraph $G_f := (V, E_f)$, definiert durch \[
		E_f := \{ e \mid e\in E, f_e/u_e < q^* \} \cup \{ e^\leftarrow \mid e\in E, f_e/u_e > 0 \},
	\]
	für solche Flüsse $f$ keine gerichteten Kreise, die eine Rückwärtskante einer maximal ausgelasteten Kante benutzen.
	
	Kanten $e\in E_f$ mit $f_e/u_e < q^*$ nennt man Vorwärtskanten und Kanten $e^\leftarrow\in E_f$ mit $f_e/u_e > 0$ Rückwärtskanten.
\end{lemma}
\begin{proof}
	\newcommand{\VK}{\text{VK}}
	\newcommand{\RK}{\text{RK}}
	Angenommen, es existiere ein einfacher Kreis $C$, der eine Rückwärtskante $e^\leftarrow$ mit $e\in E'$ enthält.
	Es seien $C_\VK$ die Menge der Vorwärtskanten und $C_\RK$ die Menge der Rückwärtskanten in $C$.
	Man setze $\gamma_\VK := \min_{e\in C_\VK} q^*u_e - f_e > 0$ als die minimale Flussmenge, die man jeder Kante in $C_\VK$ zufügen müsste, sodass mindestens eine Kante darin mindestens Auslastung $q^*$ erhält.
	Weiter sei $\gamma_\RK := \min_{e^\leftarrow\in C_\RK} f_e > 0$ die minimale Flussmenge der Rückwärtskanten in $C$.
	Wählt man nun $0 < \gamma < \min\{ \gamma_\VK, \gamma_\RK  \}$, so erhält man durch Augmentierung von $f$ entlang $Q$ mit $\gamma$ einen $b$-Fluss $\tilde{f}$.
	Bezüglich $\tilde{f}$ haben dann sowohl alle Vorwärtskanten als auch alle Rückwärtskanten von $C$ eine geringere Auslastung als $q^*$.
	Demnach ist auch $\tilde{f}$ ein minimaler $b$-Fluss, dessen maximal ausgelastete Kanten, also Kanten mit Auslastung $q^*$, eine echte Teilmenge von $E'$ sind, da mindestens eine Rückwärtskante in $E'$ enthalten war.
	Dies ist jedoch ein Widerspruch zur Inklusionsminimalität von $E'$.
\end{proof}

Weiter wird das folgende fundamentale Theorem benötigt, das den Zusammenhang zwischen der Auslastung von $b$-Flüssen und der von Schnitten aufzeigt:

\begin{theorem}\label{thm-strong-duality-sparsest-cut-min-flow}
	In einem gerichteten Netzwerk $(V, E, u)$ mit Balancevektor $b\in\R^V$ mit $\sum_{v\in V}b_v = 0$ ist die Auslastung eines $b$-Flusses $f$ mindestens so groß wie die Auslastung eines Schnittes $X$ mit ausgehenden Kanten; das heißt \[\max_{e\in E} \frac{f_e}{u_e} \geq \frac{b(X)}{u(\delta^+(X))}.\]
	Existiert darüber hinaus ein $b$-Fluss und ist $E$ nichtleer, so ist die minimale Auslastung eines $b$-Flusses gerade die Auslastung eines dünnsten Schnittes; das bedeutet
	\[
		\min_{\text{$f$ $b$-Fluss}}~\max_{e\in E}\frac{f_e}{u_e} = \max_{\substack{X\subseteq V\\ \delta^+(X)\neq\emptyset}} ~ \frac{b(X)}{u(\delta^+(X))}.
	\]
\end{theorem}
\begin{proof}
	Sei zunächst $f$ ein $b$-Fluss und $X$ ein Schnitt mit $\delta^+(X)\neq\emptyset$.
	Sei $e^*$ eine Kante mit maximaler Auslastung, also eine Kante mit $f_{e^*}/u_{e^*}=\max_{e\in E} f_e / u_e$.
	Für $e^*$ gilt somit $0\geq f_e u_{e^*} - f_{e^*}u_e$ für alle $e\in E$ und man folgere
	\[
		0\geq \frac{\sum_{e\in \delta^+(X)}(f_e u_{e^*} - f_{e^*}u_e)}{u(\delta^+(X)) u_{e^*}} = \frac{f(\delta^+(X))}{u(\delta^+(X))} - \frac{f_{e^*}}{u_{e^*}} \geq \frac{b(X)}{u(\delta^+(X))} - \frac{f_{e^*}}{u_{e^*}},
	\]
	wobei in der letzten Ungleichung $b(X) = f(\delta^+(X)) - f(\delta^-(X))$ eingeht.
	
	Sei nun ein $b$-Fluss $f$ mit minimaler Auslastung $q^*:=\max_{e\in E} f_e/u_e$ gegeben.
	Gesucht ist nun ein Schnitt mit Auslastung $q^*$.
	Ist $b$ der Nullvektor, so ist $q^*=0$ und jeder Schnitt mit ausgehenden Kanten ist ein dünnster Schnitt.
	
	Sonst sei $f$ ein $b$-Fluss minimaler Auslastung $q^* > 0$ mit möglichst wenig maximal ausgelasteten Kanten.
	Sei $e^*=vw$ eine solche maximal ausgelastete Kante und sei $X\subseteq V$ die Menge aller Knoten, die im Residualgraph $G_f$ vom Knoten $v$ erreicht werden können.
	Eine ausgehende Kante $xy\in\delta^+(X)$ muss dann Auslastung $q^*$ haben, da $x$ von $v$ in $G_f$ erreichbar ist und daher $xy$ nicht als Vorwärtskante in $G_f$ erscheinen kann; sonst wäre $y$ auch in $X$.
	Die Auslastung einer eingehenden Kante $xy\in\delta^-(X)$ muss jedoch verschwinden, da $xy$ nicht als Rückwärtskante in $G_f$ auftaucht.
	Außerdem ist $e^*\in \delta^+(X)$, da sonst $w$ von $v$ aus in $G_f$ erreichbar wäre und mit $e^{*\leftarrow}$ einen Kreis in $G_f$ bilden würde, der eine Rückwärtskante maximaler Auslastung benutzt, welchen es nach Lemma~\ref{lemma-no-circle-in-res-graph-inclus-min} nicht geben kann.
	Also ist $\delta^+(X)\neq \emptyset$ und es gilt:
	\[
		\frac{b(X)}{u(\delta^+(X))} = \frac{f(\delta^+(X))}{u(\delta^+(X))} = \sum_{e\in\delta^+(X)} \frac{u_e}{u(\delta^+(X))} q^* = q^*.
	\]
\end{proof}

\begin{corollary}\label{cor-easy-characterization-sparsest-cut}
	Seien $f$ ein $b$-Fluss mit Auslastung $q$ und $X$ ein Schnitt mit $\delta^+(X)\neq \emptyset$ in einem Netzwerk $(V, E, u)$.
	Dann sind die beiden Aussagen äquivalent:
	\begin{enumerate}[label=(\roman*)]
		\item Es sind $X$ ein dünnster Schnitt und $f$ ein $b$-Fluss minimaler Auslastung.
		\item Die Auslastung bezüglich $f$ aller ausgehenden Kanten von $X$ beträgt $q$ und $f$ verschwindet auf allen eingehenden Kanten von $X$.
	\end{enumerate}
\end{corollary}
\begin{proof}
	Aufgrund der Flusserhaltung gilt $b(X) = f(\delta^+(X)) - f(\delta^-(X))$.
	In \[
	\frac{b(X)}{u(\delta^+(X))} \leq \frac{f(\delta^+(X))}{u(\delta^+(X))} \leq \frac{u(\delta^+(X)) q}{u(\delta^+(X))} = q
	\]
	gilt Gleichheit genau dann, wenn $f(\delta^-(X))=0$ und $f_{e}/u_{e} = q$ für alle $e\in\delta^+(X)$ gelten.
	Theorem~\ref{thm-strong-duality-sparsest-cut-min-flow} liefert nun die Behauptung.
\end{proof}

\todo{Insbesondere sind alle inklusionsminimalen dünnsten Schnitte -- gegeben eines minimalen $b$-Flusses -- durch die Methode Residualgraph berechenbar (in sehr geringer polynomieller Zeit, nämlich vermutlich sogar $O(n+m)$ -- Allerdings muss man hier bisschen aufpassen, findet man ausgehend von einer maximal ausgelasteten Kante eine weitere, so muss man (für inklusionsminimalität das Vorgehen von hier zurücksetzen)}

\begin{lemma}\label{lemma-thin-flows-without-resetting-have-minimal-congestion}
	Sei ein schmaler $b$-Fluss $f$ ohne Zurücksetzen mit zugehöriger Knotenauslastung $l$ gegeben.
	Dann ist $f$ ein $b$-Fluss minimaler Auslastung $q$ und für $E\neq\emptyset$ ist $X:=\{ v\in V \mid l_v < q \}$ ein dünnster Schnitt.
\end{lemma}
\begin{proof}
	Ist $b$ der Nullvektor -- wie im Fall $E=\emptyset$ --, ist $f$ der Nullfluss, da das Netzwerk azyklisch ist.
	
	Sei also $q>0$ die Auslastung von $f$ im Falle von $b\neq 0$.
	Nach Korollar~\ref{cor-thin-flows-max-node-label-equals-max-edge-label} genügt es zu
	zeigen, dass die Auslastung jeder ausgehenden Kante von $X$ bezüglich $f$ gerade $q$ beträgt und auf eingehenden Kanten von $X$ kein Fluss fließt.
	Wegen $l_s=0$ ist $s$ im Schnitt $X$ enthalten.
	Sei $vw\in\delta^+(X)$ eine ausgehende Kante.
	Dann gilt $l_v < l_w = q $ und nach Proposition~\ref{prop-congestion-labels-dijkstra} auch $q = l_w \leq \rho_{vw}(l_v, f_{vw}) = f_{vw} / u_{vw}$.
	Da $q$ eine obere Schranke an $f_{vw}/u_{vw}$ ist, gilt also $f_{vw}/u_{vw} = q$.
	Für eine eingehende Kante $vw\in\delta^-(X)$ gilt $\rho_{vw}(l_v, f_{vw})\geq l_v > l_w$ und somit muss nach Lemma~\ref{lemma-equivalent-thin-flow} der Fluss $f$ auf der Kante $vw$ verschwinden.
\end{proof}

\begin{definition}
	Seien $\mathcal{I}:=(V, E, u, b)$ eine $b$-Fluss-Instanz und $X\subseteq V$ ein dünnster Schnitt mit Auslastung $q$.
	Dann heißt $\mathcal{I}[X] := (X, E[X], u[X], b[X])$ die \emph{durch $X$ induzierte Teilinstanz von $\mathcal{I}$},
	wobei $E[X] := \{ vw \in E \mid v, w \in X \}$ als die Menge der Kanten zwischen Knoten in $X$, $u[X]$ als die Einschränkung von $u$ auf $E[X]$ und $b[X]$ durch \[
	b[X]_v := b_v - u(\delta^+_E(v)\cap\delta^+_E(X)) q \quad \text{für $v\in X$}
\] definiert ist.
\end{definition}

Man bemerke, dass $b[X]_v \leq b_v$ für $v\in X$ erfüllt und $b[X]$ ein zulässiger Balancevektor ist: \[
	\sum_{v\in X} b[X]_v = b(X) - u(\delta^+_E(X)) q = 0
\]

\begin{proposition}\label{prop-restricted-minimal-flow-is-b-flow-on-induced-instance}
	Ist $f$ ein $b$-Fluss minimaler Auslastung einer $b$-Fluss-Instanz $(V, E, u, b)$, so ist die Einschränkung $f':=f_{\mid E[X]}$ ein $b[X]$-Fluss der induzierten Instanz $(X, E[X], u[X], b[X])$ für jeden dünnsten Schnitt $X$.
	Ist $f$ sogar ein $s$-Fluss mit Knotenauslastung $l$ und $b_s > 0$, so stimmt die Einschränkung von $l$ auf $X$ mit der Knotenauslastung $l'$ vom $s$-Fluss $f'$ überein.
\end{proposition}
\begin{proof}
	Nach Korollar~\ref{cor-easy-characterization-sparsest-cut} gelten $f_{e}/u_{e}=q$ für $e\in\delta^+(X)$ und $f_{e} = 0$ für $e\in\delta^-(X)$.
	Daher kann man zeigen, dass $f'$ ein $b[X]$-Fluss ist, denn für alle $v\in X$ gilt:
	\begin{align*}
	f'(\delta^+_{E[X]}(v)) - f'(\delta^-_{E[X]}) &= f(\delta^+_E(v)) - f(\delta^-_E(v)) - f(\delta^+_{E[X]}(v)\cap\delta^+_{E[X]}(X)) \\
	&= b_v - u(\delta^+_{E[X]}(v)\cap\delta^+_{E[X]}(X))q = b[X]_v.
	\end{align*}
	Sei nun $f$ sogar ein $s$-Fluss mit $b_s > 0$, wodurch $s$ in $X$ enthalten ist.
	Sei $v\in X$ gegeben.
	Da jeder $s$-$v$-Pfad in $(X, E')$ auch in $(V, E)$ enthalten ist, gilt bereits $l'_v\leq l_v$.
	Außerdem liegt jeder $s$-$v$-Pfad in $(V, E)$ mit positivem Fluss bezüglich $f$ auch komplett in $(X, E')$, da $f$ auf $\delta^-_E(X)$ verschwindet.
	Daraus folgt $l'_v \geq l_v$.
\end{proof}

Daher kann man bereits erkennen, dass ein schmaler Fluss ohne Zurücksetzen eingeschränkt auf eine durch einen dünnsten Schnitt induzierte Teilinstanz wieder ein schmaler Fluss ist.
Das Ziel ist es nun, aus einem schmalen Fluss der Teilinstanz einen schmalen Fluss auf der ursprünglichen Instanz zu konstruieren.

\begin{lemma}\label{lemma-flow-minimal-congestion-sparsest-cut-then-outside-X-congestion-q}
	Seien ein $s$-Fluss $f$ minimaler Auslastung $q^*$ mit zugehöriger Knotenauslastung $l_v$ und ein dünnster Schnitt $X$ in einem Netzwerk ohne zurücksetzende Kanten gegeben.
	Für alle $v\in V\setminus X$ hat jeder $s$-$v$-Pfad $P$ Auslastung $q^*=l_v$.
\end{lemma}
\begin{proof}
	Ist $b$ der Nullvektor, so ist $f$ der Nullfluss und $l_v = 0$ für alle $v\in V$.
	Sonst ist $s$ in $X$ enthalten und für alle $v\in V\setminus X$ enthält jeder $s$-$v$-Pfad mindestens eine Kante, die $X$ verlässt und nach Korollar~\ref{cor-easy-characterization-sparsest-cut} Auslastung $q^*$ besitzt.
	Da das Netz keine zurücksetzenden Kanten hat, beträgt die Auslastung also $\max_{e\in P} f_e / u_e = q^*$.
\end{proof}

\begin{corollary}
	Seien ein $s$-Fluss $f$ minimaler Auslastung sowie ein dünnster Schnitt $X$ auf einem Netzwerk ohne zurücksetzende Kanten gegeben.
	Ist $f'$ ein schmaler Fluss ohne Zurücksetzen auf der durch $X$ induzierten Teilinstanz, so ist \[
		g_e := \begin{cases}
			f'_e, & \text{falls $e\in E[X]$,} \\
			f_e, & \text{falls $e\in E\setminus E[X]$,}
		\end{cases}
	\] ein schmaler Fluss ohne Zurücksetzen auf der ursprünglichen Instanz.
\end{corollary}
\begin{proof}
	Es ist leicht zu sehen, dass $g$ ein $s$-Fluss minimaler Auslastung ist:
	Für einen Knoten $v \in V\setminus X$ ist $g(\delta^+_E(v)) - g(\delta^-_E(v)) = f(\delta^+_E(v)) - g(\delta^-_E(v)) = b_v$ und für $v\in X$ gilt \begin{align*}
	g(\delta^+_E(v)) - g(\delta^-_E(v)) =& f'(\delta^+_{E[X]}(v))  - f'(\delta^-_{E[X]}(v))  \\
	&+ f(\delta^+_E(v)\cap\delta^+_E(X)) - f(\delta^-_E(v)\cap\delta^-_E(X)) = b_v
	\end{align*}

	
	Sei ein $s$-$v$-Pfad $P$ mit positivem Fluss gegeben.
	Ist $v$ nicht in $X$, so hat $P$ nach Lemma~\ref{lemma-flow-minimal-congestion-sparsest-cut-then-outside-X-congestion-q} Auslastung $l_v$.
	Ist $v$ in $X$ enthalten, muss $P$ entlang Kanten innerhalb von $X$ laufen, da $g$ auf eingehenden Kanten von $X$ verschwindet.
	Nach Proposition~\ref{prop-restricted-minimal-flow-is-b-flow-on-induced-instance} stimmt die Auslastung von $v$ bezüglich der Einschränkung von $f$ mit der Auslastung von $v$ bezüglich $f$ überein, sodass auch die Auslastung von $P$ mit der Auslastung von $v$ bezüglich $f$ übereinstimmen.
\end{proof}

Dies bildet die Grundlage des nachfolgenden polynomiellen Algorithmus' zur Berechnung von schmalen Flüssen ohne Zurücksetzen:

\begin{algorithm}
\caption{Berechnung eines schmalen Flusses ohne Zurücksetzen}
\begin{algorithmic}[1]
\Function{ThinFlow}{$V, E, u, b, s$}
	\If{$b_s = 0$}
		\State\Return $0^E$
	\Else 
		\State Berechne $s$-Fluss $f$ minimaler Auslastung und dünnsten Schnitt $X$
		\State $f' \gets $ \Call{ThinFlow}{$X, E[X], u[X], b[X], s$}
		\ForAll{$e\in E[X]$} \State $f_e \gets f'_e$ \EndFor
		\State\Return $f$
	\EndIf
\EndFunction
\end{algorithmic}
\end{algorithm}