\section{Einführung}\label{introduction}

\newcommand{\R}{\mathbb{R}}

\begin{definition}[strategisches Spiel]
	Ein \emph{strategisches Spiel} $\mathcal{G}$ ist ein Tupel $(P, X, \theta)$, wobei $P$ eine Menge von Spielern, $X$ die Menge der Strategien  und $\theta=(\theta_p)_{p_\in P}$ die Familie der Auszahlungsfunktionen der Spieler ist, wobei $\theta_p$ eine Funktion $X^P\to\R$ für jeden Spieler $p\in P$ ist.
\end{definition}

Man beachte, dass in dieser Definition eines strategischen Spiels die Spieler eine gemeinsame Strategiemenge haben.

\begin{definition}[statisches Flussnetzwerk]
	Ein \emph{statisches Flussnetzwerk} $\mathcal{N}:=(G,s,t,\mu)$ ist ein Graph $G:=(V,E)$ mit Knoten $V$ und Kanten $E$, einer \emph{Quelle} $s\in V$, einer \emph{Senke} $t\in V$ zusammen mit einem \emph{$d$-wertigen statischen Fluss} $\mu: \mathcal{P} \to \R$, wobei $\mathcal{P}$ die Menge aller einfachen $s$-$t$-Pfade in G ist und $d=\sum_{p\in\mathcal{P}}\mu(p)$ gilt.
\end{definition}

\begin{definition}[statisches Routenplanungsspiel]
	Sei ein Graph $G:=(V,E)$ mit Knoten $V$ und Kanten $E$, einer Quelle $s\in V$, einer Senke $t\in V$ und einem Zufluss $d\in\R_+$ gegeben.
	Ein \emph{statisches Routenplanungsspiel} ist ein strategisches Spiel mit  Spielermenge $[0,d]\subseteq\R$, wobei ein Spieler als \emph{Flusspartikel} bezeichnet wird, und mit Strategiemenge $\mathcal{P}$ aller $s$-$t$-Pfade in $G$.
	Die Auszahlungsfunktion $\theta_x$ gibt die Kosten des Partikels $x$ in Abhängigkeit des Flusses an.
	
	Der Fluss $\mu$ heißt Nashfluss, falls $l_P(\mu)=min_{P'\in\mathcal{P}}l_{P'}(\mu)$ für alle $P\in\mathcal{P}$ mit $\mu_P > 0$ gilt.
\end{definition}

\section{Dynamische Flüsse mit Zeithorizont}


Betrachte Zeitraum $[0,T]$ mit $T\in\R_+$.
$d$ Spieler erscheinen an Quelle $s$ über Zeitraum von $0$ bis $T$

\begin{definition}[Netzwerk]
	Ein \emph{Netzwerk} ist ein gerichteter Graph $G=(V,E)$ mit endlicher Knotenmenge $V$ und Kantenmenge $E\subseteq V\times V$, einer \emph{Quelle} $s\in V$ und einer Senke $t\in V$.
	Jeder Kante $e\in E$ werden eine Kapazität $u_e > 0$ und eine Verzögerungszeit $\tau_e\geq 0$ zugeordnet, sodass alle Zykel $T$ eine positive Gesamtverzögerung $\sum_{e\in T}\tau_e > 0$ haben.
\end{definition}

Für ein Netzwerk $\mathcal{N}$ bezeichne $\mathcal{P}$ die Menge aller $s$-$t$-Pfade.

\begin{definition}[Fluss über Zeit]
	Ein Fluss über Zeit $f=(f^+, f^-)$ ist ein Paar zweier über die Kanten $E$ indizierten Familien von Lebesgue-integrierbaren Funktionen $f^+_e,f^-_e: \R \to \R_{\geq 0}$ an $e$ für alle $e\in E$.
	
	Dabei bezeichnen $f_e^+(\theta)$ die \emph{Einflussrate an $e$ zum Zeitpunkt $\theta\in\R$} und $f_e^-(\theta)$ die \emph{Ausflussrate aus $e$ zum Zeitpunkt $\theta\in\R$} für $e\in E$.
	
	Der (kumulative) \emph{Einfluss bzw. Ausfluss an einer Kante $e$ bis zum Zeitpunkt $\theta$} sei definiert durch $F^+_e(\theta):=\int_{[0,\theta)} f^+_e d\lambda$ bzw. $F^-_e(\theta):=\int_{[0,\theta)} f^-_e d\lambda$.
	
	Die \emph{(Länge der) Warteschlange an Kante $e$ zum Zeitpunkt $\theta\in\R$} sei definiert durch $z_e(\theta):= F_e^+(\theta) - F_e^-(\theta + \tau_e)$ und die \emph{Wartezeit an Kante $e$ zum Zeitpunkt $\theta\in\R$} sei definiert durch $q_e(\theta) = z_e / u_e$.
	
	Man beschreibe den \emph{Austrittszeitpunkt einer Kante $e$ bei Eintrittszeitpunkt $\theta$}, in dem ein Partikel eine Kante verlässt, die es zum Zeitpunkt $\theta$ betreten hat, als $T_e(\theta):=\theta + q_e(\theta) + \tau_e$.
\end{definition}

\begin{definition}[Zulässiger Fluss über Zeit]
	Sei ein Fluss über Zeit $f=(f^+, f^-)$ gegeben. $f$ heißt zulässig, falls
	\begin{enumerate}[(I)]
		\item keine Ausflussrate die Kapazität übersteigt, d.h. $\forall e\in E, \theta\in\R: f_e^-\leq u_e$, und
		\item\label{weak} Fluss eine Kante nur verlässt, falls er die Kante zuvor betreten hat, d.h. $\forall e\in E, \theta\in\R: F_e^+(\theta) \geq F_e^-(\theta + \tau_e)$, und
		\item\label{def-feasible-flow-no-flow-at-node} Fluss direkt nach der Ankunft an einem Knoten der nächsten Kante zugeordnet wird, d.h. $\forall v\in V\setminus \{ s, t \}, \theta\in\R: \sum_{e\in\delta^-(v)}f^-_e(\theta) = \sum_{e\in\delta^+(v)} f_e^+(\theta)$, und
		\item\label{def-feasible-flow-queue-with-capacity} nicht-leere Warteschlangen mit der Kapazität der Kante abgebaut werden, d.h. $\forall e\in E, \theta\in\R: q_e(\theta) > 0 \implies f_e^-(\theta + \tau_e) = u_e$.
		\todo{
		 $F_e^+(\theta) = F_e^-(\theta + \tau_e + q_e(\theta))$ für alle $e\in E, \theta\in\R$, ist das das gleiche (f.ü.)? Vermutlich nein; da fehlt irgendwie noch was: $q_e(\theta) = 0 \implies f_e^-(\theta + \tau_e) = f_e^+(\theta)$ o. Ä.}
	\end{enumerate}
\end{definition}

\todo{$\theta < 0 \implies f(\theta) = 0$}

\todo{source and sink nodes: Kein Fluss verschwindet bei Quelle, kein Fluss kommt hinzu bei Sinke}

\todo{FIFO Interpretation}

\begin{proposition}\label{prop-feasible-flow}
	Sei $e\in E$ eine Kante und $f$ ein zulässiger Fluss. Dann gilt:
	\begin{enumerate}[(i)]
		\item\label{prop-feasible-flow-T-mon-inc-cont} Die Funktion $\theta \mapsto \theta + q_e(\theta)$ ist monoton wachsend und stetig.
		\item\label{prop-feasible-flow-det-outflow} Für alle $\theta\in\R$ ist $F_e^+(\theta) = F_e^-(\theta+\tau_e+q_e(\theta))$.\todo{use $T_e(\theta)$ here}
		\item\label{prop-feasible-flow-queue-delay} Für zwei Zeitpunkte $0\leq \theta_1 < \theta_2$ mit $\int_{\theta_1}^{\theta_2} f^+_e d\lambda = 0$ und $q_e(\theta_2)>0$ ist $\theta_1 + q_e(\theta_1) = \theta_2 + q_e(\theta_2)$.
	\end{enumerate}
\end{proposition}
\begin{proof}
	Für die Monotonie in~(\ref{prop-feasible-flow-T-mon-inc-cont}) seien $\theta_1 \leq \theta_2$ gegeben.
	Mit der Monotonie von $F_e^+$ und mit $F_e^-(\theta_1 + \tau_e) = F_e^-(\theta_2+\tau_e) - \int_{\theta_1+\tau}^{\theta_2+\tau} f_e^-(t)dt\leq F_e^-(\theta_2 + \tau_e) + (\theta_2 - \theta_1)u_e$ gilt: 
	$$
		\theta_1 + q_e(\theta_1)
		= \theta_1 + \frac{F_e^+(\theta_1) - F_e^-(\theta_1 + \tau_e)}{u_e}\\
		\leq \theta_2 + \frac{F_e^+(\theta_1) - F_e^-(\theta_2+\tau_e)}{u_e} \leq \theta_2 + q_e(\theta_2).
	$$
	Die Stetigkeit folgt aus der Stetigkeit von $F_e^+$ und $F_e^-$.
	
	Zu Aussage (ii): Nach Voraussetzung~(\ref{def-feasible-flow-queue-with-capacity}) ist $\int_{\theta + \tau_e}^{\theta + \tau_e + q_e(\theta)} f_e^-(t) dt = \int_{\theta}^{\theta + q_e(\theta)}f_e^-(t + \tau_e) dt = q_e(\theta)  u_e = z_e(\theta)$ (\todo{für $\theta'$ ist $q_e(\theta')> 0$}). Damit ist $F_e^-(\theta + \tau_e + q_e(\theta)) = F_e^-(\theta+\tau_e) + \int_{\theta+\tau_e}^{\theta+\tau_e+q_e(\theta)}f_e^-(t)dt = F_e^+(\theta)$.
	
	Zu Aussage (iii): Für alle $\theta'\in [\theta_1, \theta_2]$ gilt $F_e^+(\theta_1) = F_e^+(\theta') = F_e^-(\theta_2)$.
	Also ist $F_e^+(\theta') - F_e^-(\theta' + \tau_e) \geq F_e^+(\theta_2)-F_e^-(\theta_2 + \tau_e) = z_e(\theta_2) > 0$ und es gilt $f_e^-(\theta' + \tau_e)=u_e$.
	Für die Warteschlangendifferenz gilt dann: 
	$z_e(\theta_1)-z_e(\theta_2)=-F^-(\theta_1 + \tau_e) + F^-(\theta_2 + \tau_e) = \int_{\theta_1 + \tau_e}^{\theta_2 + \tau_e} f^-_e(t) dt = (\theta_2 - \theta_1)u_e$.
	Man folgere $q_e(\theta_1) - q_e(\theta_2) = \theta_2 - \theta_1$.
\end{proof}

\todo{Insbesondere ist also die Kantenaustrittszeit $T_e$ monoton wachsend und stetig.}

\begin{corollary}\label{cor-queue-positive-inbetween}
		Für einen zulässigen  Fluss über Zeit gilt $z_e(\theta') > 0$ für $\theta'\in(\theta, \theta + q_e(\theta))$ für alle $e\in E$ und zu allen Zeitpunkten $\theta\in\R$.
\end{corollary}
\begin{proof}
	Da $\theta'>\theta$ gilt $\theta' + q_e(\theta') \geq \theta + q_e(\theta)$ wegen des monotonen Wachstums nach Proposition~\ref{prop-feasible-flow}~(\ref{prop-feasible-flow-T-mon-inc-cont}).
	Also ist $q_e(\theta') \geq (\theta - \theta') + q_e(\theta) > q_e(\theta)\geq 0$.	
\end{proof}

\todo{Stetigkeit von irgendwas um die "Wohldefiniertheit" dieser komischen Definition  von Nash flows zu zeigen}

\section{Charakterisierung von Nash-Flüssen über Zeit}

\begin{definition}
	Für einen Fluss $f$ und einen Pfad $P=(e_1,\dots,e_k)$ definiere $l^P(\theta):=T_{e_k}\circ\dots\circ T_{e_1}(\theta)$ den Zeitpunkt, an dem ein Partikel den Endknoten des Pfads erreicht, falls er den Pfad zum Zeitpunkt $\theta$ betritt.
	
	Für einen Knoten $w\in V$ beschreibe $\mathcal{P}_w$ die Menge aller $s$-$w$-Pfade.
	Dann ist die früheste Ankunft eines Partikels, das zum Zeitpunkt $\theta$ bei $s$ startet, gegeben durch $l_w(\theta):=\min_{P\in\mathcal{P}_w}l^P(\theta)$.
	Ein Pfad $P\in \mathcal{P}_w$ heißt \emph{kürzester $s$-$w$-Pfad zum Zeitpunkt $\theta$},  falls $l_w(\theta)=l^P(\theta)$.
\end{definition}

\todo{$l_v$ wohldefiniert, d.h. minimum existiert, da Pfade mit Kreisen nie das Minimum sind $\implies$ endlich viele}

Für einen Knoten $v \in V$ und einen zulässigen Fluss ist die Funktion $l_v$ als Minimum von Kompositionen stetiger und monoton wachsender Funktionen $T_e$ (Proposition~\ref{prop-feasible-flow}~(\ref{prop-feasible-flow-T-mon-inc-cont})) ebenfalls stetig und monoton wachsend.


\begin{lemma}\label{lemma-dreicksungl}
	Für alle Kanten $vw\in E$ gilt in einem zulässigen Fluss 
	$T_{vw}(l_v(\theta)) \geq l_w(\theta)$.
\end{lemma}
\begin{proof}
	Sei ein kürzester $s$-$v$-Pfad $P$ zum Zeitpunkt $\theta$ gegeben.
	Hängt man an $P$ die Kante $vw$ an, erhält man einen $s$-$w$-Pfad, der zur Eintrittszeit $\theta$ die Ankunftszeit $T_{vw}(l_v(\theta))$ liefert.
	Da $l_w(\theta)$ das Minimum über die Ankunftszeit aller $s$-$w$-Pfade ist, gilt die Behauptung.
\end{proof}

\begin{definition}
	Man bezeichne eine Kante $uv\in E$ als \emph{aktiv zum Zeitpunkt $\theta$}, falls $T_{uv}(l_u(\theta)) = l_v(\theta)$ \todo{, d.h. falls die Kante in einem kürzesten $s$-$w$-Pfad liegt}.
\end{definition}

\begin{lemma}
	Für alle Knoten $v\in V$ ist in einem zulässigen Fluss die Funktion $l_v$ monoton wachsend und stetig.
\end{lemma}
\todo{
Mittels Belman-Ford-Algorithmus kann man $l_w$ auch berechnen, indem man die Lösung des folgenden Gleichungssystem löst:

$$ l_w(\theta) = \begin{cases}
	\theta & \text{falls } w=s \\
	\min_{vw\in E} T_{vw}(l_v(\theta)) & \text{sonst}
\end{cases} $$

Warum kann man das? Zykeln?
}

Die folgende Definition entspricht der Definition~2 aus~\cite{Koch2011}.

\begin{definition}
	Man sage, der \emph{Fluss $f$ fließe nur entlang aktiver Kanten}, falls für alle Kanten $uv\in E$ und für fast-alle Zeitpunkte $\theta\in\R$ Zeitpunkt gilt: $$ uv \text{ nicht aktiv zum Zeitpunkt } \theta \implies f_{uv}^+(\l_u(\theta)) = 0.$$
\end{definition}

\begin{lemma}\label{lemma-only-active-edges}
	Für einen zulässigen Fluss $f$ sind folgende Aussagen äquivalent:
	\begin{enumerate}[(i)]
		\item Der Fluss $f$ fließt nur entlang aktiver Kanten.
		\item Für jede Kante $uv\in E$ und für alle $\theta\in\R$ gilt $F_{uv}^-(T_{uv}(l_u(\theta)) = F_{uv}^-(l_v(\theta))$.
	\end{enumerate}
\end{lemma}
\begin{proof}
	$(i)\Rightarrow (ii)$: Seien $uv\in E$ und $\theta\in\R$ gegeben.
	Die Beziehung $F_{uv}^-(T_{uv}(l_u(\theta))) \geq F_{uv}^-(l_v(\theta))$ gilt bereits wegen der Monotonie von $F_{uv}^-$ und Lemma~\ref{lemma-dreicksungl}.
	Ist $uv$ aktiv zum Zeitpunkt $\theta$, so ist $T_{uv}(l_u(\theta))=l_v(\theta)$ und die Aussage gilt offensichtlich.
	Sonst ist $l_v(\theta) < T_{uv}(l_u(\theta))$. \todo{nur für fast alle theta}
	Sei $\tilde{\theta}:=\sup\{ \tilde{\theta}\in\R \mid l_v(\theta) \geq T_{uv}(l_u(\tilde{\theta})) \}$ der späteste Startzeitpunkt, sodass man spätestens zum Zeitpunkt $l_v(\theta)$ von $s$ über $uv$ zu $v$ gelangt.
	Man beachte, dass $\tilde{\theta}=-\infty$ gilt, falls solch ein Startzeitpunkt nicht existiert.
	Es ist $\tilde{\theta} \leq \theta$, da $T_{uv}\circ l_u$ monoton wachsend ist und für $\tilde{\theta} > \theta$ wäre $T_{uv}(l_u(\tilde{\theta})) > l_v(\theta)$.
	Wegen der Monotonie von $l_v$ und nach Definition von $\tilde{\theta}$ gilt $l_v(\theta')\leq l_v(\theta)< T_{uv}(l_u(\theta'))$ für $\theta'\in (\tilde{\theta}, \theta]$; insbesondere ist die Kante $uv$ in $\theta'$ nicht aktiv und nach Voraussetzung gilt $f_{uv}^+(l_u(\theta')) = 0$ für $\theta'\in (\tilde{\theta}, \theta]$. \todo{fast alle?}
	Also ist $F_{uv}^+(l_u(\theta)) = F_{uv}^+(l_u(\tilde{\theta}))$. Nach Proposition~\ref{prop-feasible-flow}~(\ref{prop-feasible-flow-det-outflow}) ist dann $F_{uv}^-(T_{uv}(l_u(\theta))) = F_{uv}^-(T_{uv}(l_u(\tilde{\theta}))\leq F_{uv}^-(l_v(\theta))$ wegen Montonie von $F_{uv}^-$ und der Definition von $\tilde{\theta}$.
	
	$(ii) \Rightarrow (i)$: Sei eine Kante $uv\in E$, die zu einem Zeitpunkt $\theta\in\R$ nicht aktiv ist, gegeben.
	Es gilt also $l_v(\theta) < T_{uv}(l_u(\theta))$ und wegen der Stetigkeit von $l_v$ und von $T_{uv}\circ l_u$ existiert ein $\varepsilon\in\R_+$ sodass $l_v(\theta + \varepsilon) < T_{uv}(l_u(\theta - \varepsilon))$ gilt.
	Dann ist 
	$$
	0
	\leq
	\int_{l_u(\theta-\varepsilon)}^{l_u(\theta + \varepsilon)}f_{uv}^+(t) dt
	=
	\int_{T_{uv}(l_u(\theta-\varepsilon))}^{T_{uv}(l_u(\theta+\varepsilon))} f_{uv}^-(t) dt
	\leq
	\int_{l_v(\theta + \varepsilon)}^{T_{uv}(l_u(\theta + \varepsilon))} f_{uv}^-(t) dt
	=
	0,
	$$
	wobei die letzte Gleichung aus der Voraussetzung $F_{uv}^-(l_v(\theta+\varepsilon)) = F_{uv}^-(T_{uv}(l_u(\theta + \varepsilon)))$ gefolgert wird.
	Also ist $f_{uv}^+$ in einer Umgebung um $l_u(\theta)$ fast überall gleich $0$.
	
	\todo{Da die Menge aller Zeitpunkte, in denen $uv$ nicht aktiv ist, wegen der Stetigkeit von $l_v$ und $T_{uv}\circ l_u$ eine Vereinigung (abzählbarer) Intervalle ist, genügt es zu zeigen, dass die Bedingung lokal fast immer erfüllt ist.}
\end{proof}


\todo{blablabla Definition FIFO bla}

\begin{definition}
	Für eine Kante $uv\in E$ bezeichne $x_{uv}^+(\theta):= F_{uv}^+(l_u(\theta))$ die Flussmenge, die die Kante $uv$ betreten hat, bevor Partikel, die zur Zeit $\theta$ in $s$ starten, $u$ erreichen können.
	
	Mit $x_{uv}^-(\theta):= F^-_{uv}(l_v(\theta))$ bezeichne man die Flussmenge, die die Kante $uv$ verlassen hat, bevor Partikel, die zur Zeit $\theta$ in $s$ starten, $v$ erreichen können.
	
	Für einen Knoten $v\in V$ sei $b_v(\theta):=\sum_{e\in\delta^+(v)} x_e^+(\theta) - \sum_{e\in\delta^-(v)} x_e^-(\theta)$ die Balance des Knoten $v$ zum Zeitpunkt $\theta$.
\end{definition}


\begin{remark}\label{remark-x^-leqx^+}
	In einem zulässigen Fluss ist $x_{uv}^-(\theta) = F_{uv}^-(l_v(\theta)) \leq F_{uv}^-(T_{uv}(l_u(\theta)))=F_{uv}^+(l_u(\theta)) = x_{uv}^+(\theta)$
	 nach Proposition~\ref{prop-feasible-flow}~(\ref{prop-feasible-flow-det-outflow}) und mit der Monotonie von $F_{uv}^+$.
\end{remark}

\begin{lemma}\label{lemma-balance-0}
	Für einen zulässigen Fluss über Zeit $f$ gilt $b_v(\theta)=0$ für alle Knoten $v\in V\setminus\{ s,t \}$ und alle $\theta\in\R$.
\end{lemma}
\begin{proof}
	Unter Benutzung der Voraussetzung~(\ref{def-feasible-flow-no-flow-at-node}) folgere man für $v\in V\setminus \{ s, t\}, \theta\in\R$:
	$$\sum_{e\in\delta^-(v)} x_e^-(\theta) = \int_{0}^{l_v(\theta)} \sum_{e\in\delta^-(v)} f_e^-(t) dt = \int_{0}^{l_v(\theta)} \sum_{e\in\delta^+(v)} f_e^+(t) dt = \sum_{e\in\delta^+(v)}x_e^+(\theta)$$
\end{proof}

\begin{definition}
	Man sage, ein Fluss über Zeit $f$ \emph{fließe ohne Überholungen}, falls $b_s(\theta) = -b_t(\theta)$ für alle $\theta\in\R$.
\end{definition}

\todo{blabla definition blabla}

\begin{definition}
	Seien ein statischer Fluss, das heißt eine Kantenbewertung $f \in \R^E$, in einem Graphen $G=(V,E)$ und ein Balancevektor $b\in\R^V$ mit $\sum_{v\in V} b_v = 0$ sowie ein Kapazitätsvektor $u\in\R_+^E$ gegeben.
	Der Fluss $f$ heißt \emph{$b$-Fluss}, falls er Flusserhaltung bzgl. $b$ gewährt, d.h. $\forall v\in V: \sum_{e\in\delta^+(v)}f_e - \sum_{e\in\delta^-(v)}f_e = b_v$.
\end{definition}

\todo{blabla}

\newcommand{\newv}{\mathbf{v}}
\begin{lemma}\label{lemma-b-graph}
	Seien ein zulässiger Fluss über Zeit $f$ in einem Graphen $G=(V,E)$ und ein Zeitpunkt $\theta\in\R$ gegeben.
	Der Graph $H$ entstehe aus $G$, indem man jede Kante $uv\in E$ aus $G$ durch einen neuen Knoten $\newv_{uv}$ und zwei Kanten $u\newv_{uv}$ und $\newv_{uv}v$ ersetze.
	Der statische Fluss $g$ auf $H$ sei definiert durch
	$$g_{u\newv_{uv}} := x_{uv}^+(\theta) \text{ und } g_{\newv_{uv}v} := x_{uv}^-(\theta) \text{ für alle $uv\in E$}$$
	und der Balancevektor $b$ auf $H$ sei gegeben durch $b_v:= b_v(\theta)$ für $v\in V$ und $b_{\newv_e}:= x_e^-(\theta) - x_e^+(\theta)$ für $e\in E$.
	Dann gelten die folgenden Aussagen:
	
	\begin{enumerate}[(i)]
		\item  $g$ ist ein statischer $b$-Fluss.
		\item\label{lemma-b-graph-imp} $\forall e\in E : x_e^+(\theta) = x_e^-(\theta)\iff b_s(\theta) + b_t(\theta) = 0$.
	\end{enumerate}
\end{lemma} 
\begin{proof}
	$(i)$: Um zu zeigen, dass die Summe über die Balancevektoreinträge verschwindet, betrachte man den Einfluss einer Kante $e\in E$ auf $\sum_{v_\in V} b_v$, der gerade $x_e^+(\theta) - x_e^-(\theta)$ ist, und es ergibt sich:
		$$\sum_{v\in V}b_v + \sum_{e\in E} b_{\newv_e} = \sum_{e\in E}  (x_e^+(\theta) - x_e^-(\theta) + x_e^-(\theta) - x_e^+(\theta)) = 0.$$
		Es bleibt zu zeigen, dass $g$ bezüglich $b$ Flusserhaltung gewährt.
		Für die Knoten der Form $\newv_{uv}$ gilt dies, da $g_{\newv_{uv}v} - g_{u\newv_{uv}} = x_{uv}^-(\theta) - x_{uv}^+(\theta) = b_{\newv_e}$.
		Für $v\in V$ gilt nach Konstruktion $$b_v = b_v(\theta)=
		\sum_{e\in\delta^+_G(v)} x_{e}^+(\theta) - \sum_{e\in\delta^-_G(v)} x_{e}^-(\theta) =
	\sum_{e\in\delta_H^+(v)} g_e - \sum_{e\in\delta^-_H(v)}g_e
		.$$
	
	$(ii)$: Tatsächlich benötigt man aus $(i)$ nur die Eigenschaft, dass die Summe über die Einträge des Balancevektors verschwindet.
	Mit Lemma~\ref{lemma-balance-0} gilt wegen der Zulässigkeit von $f$ sogar $b_s(\theta)+b_t(\theta) + \sum_{e\in E} b_{\newv_e} = 0$.
	
	Angenommen, es gelte $x_e^+(\theta) = x_e^-(\theta)$ für alle $e\in E$.
	Dann sind auch alle $b_{\newv_e} = 0$ und es gilt $b_s(\theta) + b_t(\theta) = 0$.
	
	Angenommen, es gelte $b_s(\theta) + b_t(\theta) = 0$.
	Dann ist $\sum_{e\in E} b_{\newv_e} = 0$ und, da $f$ zulässig ist, gilt $x_e^-(\theta)\leq x_e^+(\theta)$ nach Bemerkung~\ref{remark-x^-leqx^+}   und damit $b_{\newv_e}\leq 0$ für alle $e\in E$.
	Also sind bereits alle $b_{\newv_e} = 0$, was die Behauptung zeigt.
\end{proof}


\begin{theorem}\label{thm-equivalencies-nash-flow}
	Für einen zulässigen Fluss über Zeit $f$ sind die folgenden Aussagen äquivalent:
	\begin{enumerate}[(i)]
		\item Der Fluss $f$ fließt nur entlang aktiver Kanten
		\item Für alle Kanten $e\in E$ und zu allen Zeitpunkten $\theta\in\R$ ist $x_e^+(\theta) = x_e^-(\theta)$.
		\item Der Fluss $f$ fließt ohne Überholungen.
		\item \todo{Der Fluss über Zeit ist ein Nash-Fluss über Zeit}
	\end{enumerate}
	\todo{Gilt eine dieser Aussagen, so nennt man $f$ einen \emph{Nash-Fluss über Zeit}.}
\end{theorem}
\begin{proof}
	$(i) \Leftrightarrow (ii):$ Für eine Kante $uv\in E$ und einen Zeitpunkt $\theta\in\R$ gilt nach Proposition~\ref{prop-feasible-flow}~(\ref{prop-feasible-flow-det-outflow}):
	$$x_{uv}^+(\theta) - x_{uv}^-(\theta) = F_{uv}^+(l_u(\theta)) - F_{uv}^-(\l_v(\theta)) = F_{uv}^-(T_{uv}(l_u(\theta))) - F_{uv}^-(l_v(\theta)).$$
	Nach Lemma~\ref{lemma-only-active-edges} gilt also die gewünschte Äquivalenz.
	
	$(ii) \Leftrightarrow (iii):$ Die Bedingung, $f$ fließe ohne Überholungen, bedeutet gerade, dass für alle $\theta\in\R: b_s(\theta) + b_t(\theta) = 0$ ist.
	Lemma~\ref{lemma-b-graph}~(\ref{lemma-b-graph-imp}) liefert die gewünschte Biimplikation.
\end{proof}

\section{A special class of static flows}

\begin{lemma}\label{lemma-no-inflow-until-l}
	Sei $f$ ein zulässiger Fluss über Zeit.
	Dann gilt $F_{vw}^+(l_v(0)) = 0$ für jede Kante $vw\in E$.
\end{lemma}
\begin{proof}
	Für alle $\theta\in [0, l_v(0)]$ gilt nach Bedingung~(\ref{def-feasible-flow-no-flow-at-node}), dass $f_{vw}^+(\theta) \leq \sum_{e\in\delta^-(v)} f_e^-(\theta)$.
	Also ist $F_{vw}^+(l_v(0)) \leq \sum_{uv\in\delta^-(v)} F_{uv}^-(l_v(0))\leq \sum_{uv\in\delta^-(v)} F_{uv}^+(l_u(0))$ nach Bemerkung~\ref{remark-x^-leqx^+}.
	\todo{TODO this doesn't work yet}
\end{proof}

\begin{lemma}\label{lemma-nash-flow-waiting-queue-implies-active-edge}
	Seien $f$ ein Nash-Fluss über Zeit, $uv\in E$ eine Kante und $\theta\in\R$ ein Zeitpunkt gegeben, sodass $q_{uv}(l_v(\theta)) > 0$.
	Dann ist die Kante $e$ aktiv zum Zeitpunkt $\theta$.
\end{lemma}
\begin{proof}
	Es ist zu zeigen, dass $T_{uv}(l_u(\theta)) \leq l_v(\theta)$.
	Da $q_{uv}(l_u(\theta)) > 0$, ist auch $F^+_{uv}(l_u(\theta)) > 0$.
	Nach Lemma~\ref{lemma-no-inflow-until-l} ist $F_{uv}(l_u(0))=0$ und wegen der Stetigkeit und Monotonie von $F_{uv}^+\circ l_u$ existiert
	ein frühester Zeitpunkt $\theta_1\in (0, \theta]$ mit $F_{uv}^+(l_u(\theta_1)) = F_{uv}^+(l_u(\theta))$.
	Für ein beliebiges $\varepsilon>0$ ist also $F_{uv}^+(l_u(\theta_1-\varepsilon)) < F_{uv}(l_u(\theta_1))$ und es gibt eine Teilmenge $Q_\varepsilon \subseteq [\theta_1 - \varepsilon, \theta_1]$ mit Maß größer 0 und $f_{uv}^+\circ l_u\big|_{Q_\varepsilon} > 0$.
	Da $f$ ein Nash-Fluss ist, fließt $f$ nach Theorem~\ref{thm-equivalencies-nash-flow} nur entlang aktiver Kanten, d.h. für fast-alle $\theta_\varepsilon\in Q_\varepsilon$ ist $dT_{uv}(l_u(\theta_\varepsilon))=l_v(\theta_\varepsilon)$.
	Für $\varepsilon\rightarrow0$ gilt wegen der Stetigkeit $T_{uv}(l_u(\theta_1))=l_v(\theta_1)$.
	Nach Proposition~\ref{prop-feasible-flow}~(\ref{prop-feasible-flow-queue-delay}) ist $T_{uv}(l_u(\theta_1)) = T_{uv}(l_u(\theta))$ und mit der Monotonie von $l_u$ folgt $T_{uv}(l_u(\theta))\leq l_v(\theta)$.
\end{proof}
\todo{Das ist glaub ich die Definition von schwachem Nash-flow}

\begin{definition}[Schmaler Fluss mit Zurücksetzen]
	Seien ein statischer $F$-wertiger Fluss $f$ in einem Graph $G=(V,E)$ mit Kantenkapazitäten $u\in\R^E$, eine Quelle $s\in V$ mit Einflusskapazität $d\in\R$ und eine Senke $t\in V$ sowie eine Teilmenge $E_1\subseteq E$ von Kanten gegeben.
	Der Fluss $f$ heißt \emph{schmaler Fluss mit Zurücksetzen auf $E_1$}, falls eine Knotenbewertung $l\in\R^V$ existiert mit:
	$$\begin{array}{ll}
	(1)~~~	l_s = F/d& \\
	(2)~~~	l_v \leq l_u &\text{für $uv\in E \setminus E_1$ mit $f_{uv}=0$}\\
	(3)~~~	l_v = \max(l_u, f_{uv} / u_{uv} ) &\text{für $uv\in E\setminus E_1$ mit $f_{uv} > 0$}\\
	(4)~~~	l_v = f_{uv} / u_{uv} & \text{für $uv\in E_1$}
	\end{array}$$
\end{definition}

\begin{theorem}
	Seien ein Nash-Fluss über Zeit $f$ auf einem Graphen $G=(V,E)$ gegeben sowie ein Zeitpunkt $\theta$ gegeben.
	Der zum Fluss $f$ und dem Zeitpunkt $\theta$ zugeordnete statische Fluss sei $x(\theta)$ mit $x_{uv}(\theta) := F^+_{uv}(l_u(\theta)) = F^-_{uv}(l_v(\theta))$.\todo{(muss vlt noch gezeigt werden)}
	Man betrachte den Teilgraph $G_\theta = (V, E_\theta)$, der nur zum Zeitpunkt $\theta$ aktive Kanten enthält, d.h. $E_\theta := \{ uv\in E \mid T_{uv}(l_u(\theta)) = l_v(\theta) \}$.
	
	Existieren die Ableitungen $\frac{dx_e}{d\theta}(\theta)$ und $\frac{dl_v}{d\theta}(\theta)$ für alle $e\in E$ und $v\in V$, so ist der statische Fluss $g\in\R^{E_\theta}$ mit $g_e:=\frac{dx_e}{d\theta}(\theta)$ ein schmaler $d$-wertiger Fluss mit Zurücksetzen auf den Kanten mit Warteschlange $E_1:=\{uv\in E \mid q_{uv}(l_u(\theta))>0 \}$ im Graphen $G_\theta$.
	Als Knotenbewertung dienen dazu die Ableitungen $(\frac{dl_v}{d\theta}(\theta))_{v\in V}$.
\end{theorem}
\begin{proof}
	zu zeigen: $\frac{dl_s}{d\theta}(\theta) = F/d$.
	Dabei ist $\frac{dl_s}{d\theta}(\theta) = 1$, da $l_s(\theta) = \theta$. Bleibt zu zeigen $F= d$.
	Der Wert von $g$ ist $\frac{d}{d\theta}\sum_{e\in\delta^+(s)}x_e(\theta) = \frac{d}{d\theta} d\cdot\theta = d$. \todo{Geht auch mit variablen Einfluss}.
	
	Sei nun eine Kante $uv\in E_\theta$, also eine aktive Kante zum Zeitpunkt $\theta$, gegeben. Wir prüfen die restlichen drei Bedingungen jeweils in den folgenden drei Fällen:
	
	\begin{description}
		\item[1. Fall:] $\exists \varepsilon > 0:\forall \theta'\in (\theta, \theta + \varepsilon ] : q_{uv}(l_u(\theta')) > 0$.
		
		Für $\theta'\in(\theta,\theta+\varepsilon]$ ist die Wartezeit $q_{uv}(l_u(\theta'))$ positiv und nach Korollor~\ref{cor-queue-positive-inbetween} ist $q_{uv}$ positiv auf dem Intervall $[ l_u(\theta')  , l_u(\theta')+q_{uv}(l_u(\theta')) )$.
		Also ist $q_{uv}$ positiv auf dem Intervall $( l_u(\theta) , l_u(\theta + \varepsilon) + q_{uv}(l_u(\theta + \varepsilon) )
		\subseteq ( l_u(\theta) + q_{uv}(l_u(\theta)) , l_u(\theta + \varepsilon) + q_{uv}(l_u(\theta) + \varepsilon ) )$.
		
		Nach Voraussetzung ist die Kante ${uv}$ nach Lemma~\ref{lemma-nash-flow-waiting-queue-implies-active-edge} auch für $\theta'\in  (\theta, \theta + \varepsilon ]$ aktiv und es gilt $l_v(\theta') = T_{uv}(l_u(\theta')) = \l_u(\theta') + q_{uv}(\theta') + \tau_{uv}$.
		Mit Bedingung~(\ref{def-feasible-flow-queue-with-capacity}) folgere man $x_{uv}(\theta + \varepsilon) - x_{uv}(\theta) = F_{uv}^-(l_v(\theta + \varepsilon)) - F_{uv}^-(l_v(\theta))
		= \int_{l_v(\theta)}^{l_v(\theta + \varepsilon)} f_{uv}^-(t) dt
		= \int_{l_u(\theta) + q_{uv}(\theta)}^{l_u(\theta + \varepsilon) + q_{uv}(\theta + \varepsilon)} f_{uv}^-(t + \tau_{uv}) dt
		= u_{uv} (l_v(\theta + \varepsilon) - l_v(\theta))$.
		Teilt man diese Gleichung durch $\varepsilon$, so erhält man für $\varepsilon\rightarrow 0$ die Bedingung $g_{uv} = \frac{dx_{uv}}{d\theta}(\theta) = u_{uv} \frac{dl_v}{d\theta}(\theta)$.
		Ist $uv\in E_1$, so ist also Bedingung (4) erfüllt.

		Ist $uv\notin E_1$, ist also die Warteschlange zum Zeitpunkt $l_u(\theta)$ leer, so gilt: $l_v(\theta+\varepsilon) - l_v(\theta) = l_u(\theta + \varepsilon) + q_{uv}(l_u(\theta + \varepsilon)) - l_u(\theta) \geq l_u(\theta + \varepsilon) - l_u(\theta)$.
		Teilt man wieder durch $\varepsilon$, so erhält man für $\varepsilon  \rightarrow 0$ Bedingung (3) mit $\frac{dl_v}{d\theta}(\theta) \leq \frac{dl_u}{d\theta}(\theta)$ und dem Resultat des letzten Absatzes.
		\todo{FRAGEN: Es ist sogar $\frac{dl_v}{d\theta}(\theta) = \frac{dl_u}{d\theta}$, da $\frac{dq_{uv}\circ l_u}{d\theta}(\theta) = 0$. Damit gilt auch Bedingung (2). Aber $q_{uv}\circ l_u$ ist nicht unbedingt f.ü. diff'bar. Oder doch?}
		
		
		\item[2. Fall:] $\exists \varepsilon > 0: \forall \theta'\in(\theta, \theta + \varepsilon]: T_{uv}(l_u(\theta'))>l_v(\theta')$.
	\end{description}
	
\end{proof}