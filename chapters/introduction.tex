\section{Einführung}\label{introduction}

\newcommand{\R}{\mathbb{R}}

\begin{definition}[strategisches Spiel]
	Ein \emph{strategisches Spiel} $\mathcal{G}$ ist ein Tupel $(P, X, \theta)$, wobei $P$ eine Menge von Spielern, $X$ die Menge der Strategien  und $\theta=(\theta_p)_{p_\in P}$ die Familie der Auszahlungsfunktionen der Spieler ist, wobei $\theta_p$ eine Funktion $X^P\to\R$ für jeden Spieler $p\in P$ ist.
\end{definition}

Man beachte, dass in dieser Definition eines strategischen Spiels die Spieler eine gemeinsame Strategiemenge haben.

\begin{definition}[statisches Flussnetzwerk]
	Ein \emph{statisches Flussnetzwerk} $\mathcal{N}:=(G,s,t,\mu)$ ist ein Graph $G:=(V,E)$ mit Knoten $V$ und Kanten $E$, einer \emph{Quelle} $s\in V$, einer \emph{Senke} $t\in V$ zusammen mit einem \emph{$d$-wertigen statischen Fluss} $\mu: \mathcal{P} \to \R$, wobei $\mathcal{P}$ die Menge aller einfachen $s$-$t$-Pfade in G ist und $d=\sum_{p\in\mathcal{P}}\mu(p)$ gilt.
\end{definition}

\begin{definition}[statisches Routenplanungsspiel]
	Sei ein Graph $G:=(V,E)$ mit Knoten $V$ und Kanten $E$, einer Quelle $s\in V$, einer Senke $t\in V$ und einem Zufluss $d\in\R_+$ gegeben.
	Ein \emph{statisches Routenplanungsspiel} ist ein strategisches Spiel mit  Spielermenge $[0,d]\subseteq\R$, wobei ein Spieler als \emph{Flusspartikel} bezeichnet wird, und mit Strategiemenge $\mathcal{P}$ aller $s$-$t$-Pfade in $G$.
	Die Auszahlungsfunktion $\theta_x$ gibt die Kosten des Partikels $x$ in Abhängigkeit des Flusses an.
	
	Der Fluss $\mu$ heißt Nashfluss, falls $l_P(\mu)=min_{P'\in\mathcal{P}}l_{P'}(\mu)$ für alle $P\in\mathcal{P}$ mit $\mu_P > 0$ gilt.
\end{definition}

\section{Dynamische Flüsse mit Zeithorizont}


Betrachte Zeitraum $[0,T]$ mit $T\in\R_+$.
$d$ Spieler erscheinen an Quelle $s$ über Zeitraum von $0$ bis $T$

\begin{definition}[Netzwerk]
	Ein \emph{Netzwerk} ist ein gerichteter Graph $G=(V,E)$ mit endlicher Knotenmenge $V$ und Kantenmenge $E\subseteq V\times V$, einer \emph{Quelle} $s\in V$ und einer Senke $t\in V$.
	Jeder Kante $e\in E$ werden eine Kapazität $u_e > 0$ und eine Verzögerungszeit $\tau_e\geq 0$ zugeordnet, sodass alle Zykel $T$ eine positive Gesamtverzögerung $\sum_{e\in T}\tau_e > 0$ haben.
\end{definition}

Für ein Netzwerk $\mathcal{N}$ bezeichne $\mathcal{P}$ die Menge aller $s$-$t$-Pfade.

\begin{definition}[Fluss über Zeit]
	Ein Fluss über Zeit $f=(f^+, f^-)$ ist ein Paar zweier über die Kanten $E$ indizierten Familien von Lebesgue-integrierbaren Funktionen $f^+_e,f^-_e: \R \to \R_{\geq 0}$ an $e$ für alle $e\in E$.
	
	Dabei bezeichnen $f_e^+(\theta)$ die \emph{Einflussrate an $e$ zum Zeitpunkt $\theta\in\R$} und $f_e^-(\theta)$ die \emph{Ausflussrate aus $e$ zum Zeitpunkt $\theta\in\R$} für $e\in E$.
	
	Der (kumulative) \emph{Einfluss bzw. Ausfluss an einer Kante $e$ bis zum Zeitpunkt $\theta$} sei definiert durch $F^+_e(\theta):=\int_{[0,\theta)} f^+_e d\lambda$ bzw. $F^-_e(\theta):=\int_{[0,\theta)} f^-_e d\lambda$.
	
	Die \emph{(Länge der) Warteschlange an Kante $e$ zum Zeitpunkt $\theta\in\R$} sei definiert durch $z_e(\theta):= F_e^+(\theta) - F_e^-(\theta + \tau_e)$ und die \emph{Wartezeit an Kante $e$ zum Zeitpunkt $\theta\in\R$} sei definiert durch $q_e(\theta) = z_e / u_e$.
	
	Man beschreibe den \emph{Austrittszeitpunkt einer Kante $e$ bei Eintrittszeitpunkt $\theta$}, in dem ein Partikel eine Kante verlässt, die es zum Zeitpunkt $\theta$ betreten hat, als $T_e(\theta):=\theta + q_e(\theta) + \tau_e$.
\end{definition}

\begin{definition}[Zulässiger Fluss über Zeit]
	Sei ein Fluss über Zeit $f=(f^+, f^-)$ gegeben. $f$ heißt zulässig, falls
	\begin{enumerate}[(I)]
		\item keine Ausflussrate die Kapazität übersteigt, d.h. $\forall e\in E, \theta\in\R: f_e^-\leq u_e$, und
		\item\label{weak} Fluss eine Kante nur verlässt, falls er die Kante zuvor betreten hat, d.h. $\forall e\in E, \theta\in\R: F_e^+(\theta) \geq F_e^-(\theta + \tau_e)$, und
		\item Fluss direkt nach der Ankunft an einem Knoten der nächsten Kante zugeordnet wird, d.h. $\forall v\in V\setminus \{ s, t \}, \theta\in\R: \sum_{e\in\delta^-(v)}f^-_e(\theta) = \sum_{e\in\delta^+(v)} f_e^+(\theta)$, und
		\item\label{queue-with-capacity} nicht-leere Warteschlangen mit der Kapazität der Kante abgebaut werden, d.h. $\forall e\in E, \theta\in\R: q_e(\theta) > 0 \implies f_e^-(\theta + \tau_e) = u_e$.
		\todo{
		 $F_e^+(\theta) = F_e^-(\theta + \tau_e + q_e(\theta))$ für alle $e\in E, \theta\in\R$, ist das das gleiche (f.ü.)?}
	\end{enumerate}
\end{definition}

\todo{source and sink nodes: Kein Fluss verschwindet bei Quelle, kein Fluss kommt hinzu bei Sinke}

\todo{FIFO Interpretation}

\begin{proposition}\label{prop-feasible-flow}
	Sei $e\in E$ eine Kante und $f$ ein zulässiger Fluss. Dann gilt:
	\begin{enumerate}[(i)]
		\item\label{prop-feasible-flow-T-mon-inc-cont} Die Funktion $\theta \mapsto \theta + q_e(\theta)$ ist monoton wachsend und stetig.
		\item\label{prop-feasible-flow-det-outflow} Für alle $\theta\in\R$ ist $F_e^+(\theta) = F_e^-(\theta+\tau_e+q_e(\theta))$.\todo{use $T_e(\theta)$ here}
		\item Für zwei Zeitpunkte $0\leq \theta_1 < \theta_2$ mit $\int_{\theta_1}^{\theta_2} f^+_e d\lambda = 0$ und $q_e(\theta_2)>0$ ist $\theta_1 + q_e(\theta_1) = \theta_2 + z_e(\theta_2)$.
	\end{enumerate}
\end{proposition}
\begin{proof}
	Für die Monotonie in~(\ref{prop-feasible-flow-T-mon-inc-cont}) seien $\theta_1 \leq \theta_2$ gegeben.
	Mit der Monotonie von $F_e^+$ und mit $F_e^-(\theta_1 + \tau_e) = F_e^-(\theta_2+\tau_e) - \int_{\theta_1+\tau}^{\theta_2+\tau} f_e^-(t)dt\leq F_e^-(\theta_2 + \tau_e) + (\theta_2 - \theta_1)u_e$ gilt: 
	$$
		\theta_1 + q_e(\theta_1)
		= \theta_1 + \frac{F_e^+(\theta_1) - F_e^-(\theta_1 + \tau_e)}{u_e}\\
		\leq \theta_2 + \frac{F_e^+(\theta_1) - F_e^-(\theta_2+\tau_e)}{u_e} \leq \theta_2 + q_e(\theta_2).
	$$
	Die Stetigkeit folgt aus der Stetigkeit von $F_e^+$ und $F_e^-$.
	
	Zu Aussage (ii): Nach Voraussetzung~(\ref{queue-with-capacity}) ist $\int_{\theta + \tau_e}^{\theta + \tau_e + q_e(\theta)} f_e^-(t) dt = \int_{\theta}^{\theta + q_e(\theta)}f_e^-(t + \tau_e) dt = q_e(\theta)  u_e = z_e(\theta)$ (\todo{für $\theta'$ ist $q_e(\theta')> 0$}). Damit ist $F_e^-(\theta + \tau_e + q_e(\theta)) = F_e^-(\theta+\tau_e) + \int_{\theta+\tau_e}^{\theta+\tau_e+q_e(\theta)}f_e^-(t)dt = F_e^+(\theta)$.
	
	Zu Aussage (iii): Für alle $\theta'\in [\theta_1, \theta_2]$ gilt $F_e^+(\theta_1) = F_e^+(\theta') = F_e^-(\theta_2)$.
	Also ist $F_e^+(\theta') - F_e^-(\theta' + \tau_e) \geq F_e^+(\theta_2)-F_e^-(\theta_2 + \tau_e) = z_e(\theta_2) > 0$ und es gilt $f_e^-(\theta' + \tau_e)=u_e$.
	Für die Warteschlangendifferenz gilt dann: 
	$z_e(\theta_1)-z_e(\theta_2)=-F^-(\theta_1 + \tau_e) + F^-(\theta_2 + \tau_e) = \int_{\theta_1 + \tau_e}^{\theta_2 + \tau_e} f^-_e(t) dt = (\theta_2 - \theta_1)u_e$.
	Man folgere $q_e(\theta_1) - q_e(\theta_2) = \theta_2 - \theta_1$.
\end{proof}

Insbesondere ist also die Kantenaustrittszeit $T_e$ monoton wachsend und stetig.

\todo{Stetigkeit von irgendwas um die "Wohldefiniertheit" dieser komischen Definition  von Nash flows zu zeigen}

\section{Charakterisierung von Nash-Flüssen über Zeit}

\begin{definition}
	Für einen Fluss $f$ und einen Pfad $P=(e_1,\dots,e_k)$ definiere $l^P(\theta):=T_{e_k}\circ\dots\circ T_{e_1}(\theta)$ den Zeitpunkt, an dem ein Partikel den Endknoten des Pfads erreicht, falls er den Pfad zum Zeitpunkt $\theta$ betritt.
	
	Für einen Knoten $w\in V$ beschreibe $\mathcal{P}_w$ die Menge aller $s$-$w$-Pfade.
	Dann ist die früheste Ankunft eines Partikels, das zum Zeitpunkt $\theta$ bei $s$ startet, gegeben durch $l_w(\theta):=\min_{P\in\mathcal{P}_w}l^P(\theta)$.
	Ein Pfad $P\in \mathcal{P}_w$ heißt \emph{kürzester $s$-$w$-Pfad zum Zeitpunkt $\theta$},  falls $l_w(\theta)=l^P(\theta)$.
\end{definition}

Für einen Knoten $v \in V$ und einen zulässigen Fluss ist die Funktion $l_v$ als Minimum von Kompositionen stetiger und monoton wachsender Funktionen $T_e$ (Proposition~\ref{prop-feasible-flow}~(\ref{prop-feasible-flow-T-mon-inc-cont})) ebenfalls stetig und monoton wachsend.


\begin{lemma}\label{lemma-dreicksungl}
	Für alle Kanten $vw\in E$ gilt in einem zulässigen Fluss 
	$T_{vw}(l_v(\theta)) \geq l_w(\theta)$.
\end{lemma}
\begin{proof}
	Sei ein kürzester $s$-$v$-Pfad $P$ zum Zeitpunkt $\theta$ gegeben.
	Hängt man an $P$ die Kante $vw$ an, erhält man einen $s$-$w$-Pfad, der zur Eintrittszeit $\theta$ die Ankunftszeit $T_{vw}(l_v(\theta))$ liefert.
	Da $l_w(\theta)$ das Minimum über die Ankunftszeit aller $s$-$w$-Pfade ist, gilt die Behauptung.
\end{proof}

\begin{definition}
	Man bezeichne eine Kante $uv\in E$ als \emph{aktiv zum Zeitpunkt $\theta$}, falls $T_{vw}(l_v(\theta)) = l_w(\theta)$, d.h. falls die Kante in einem kürzesten $s$-$w$-Pfad liegt.
\end{definition}

\begin{lemma}
	Für alle Knoten $v\in V$ ist in einem zulässigen Fluss die Funktion $l_v$ monoton wachsend und stetig.
\end{lemma}
\todo{
Mittels Belman-Ford-Algorithmus kann man $l_w$ auch berechnen, indem man die Lösung des folgenden Gleichungssystem löst:

$$ l_w(\theta) = \begin{cases}
	\theta & \text{falls } w=s \\
	\min_{vw\in E} T_{vw}(l_v(\theta)) & \text{sonst}
\end{cases} $$

Warum kann man das? Zykeln?
}

Die folgende Definition entspricht der Definition~2 aus~\cite{Koch2011}.

\begin{definition}
	Man sage, der \emph{Fluss $f$ fließe nur entlang aktiver Kanten}, falls für alle Kanten $uv\in E$ und für fast-alle Zeitpunkte $\theta\in\R$ Zeitpunkt gilt: $$ uv \text{ nicht aktiv zum Zeitpunkt } \theta \implies f_{uv}^+(\l_u(\theta)) = 0.$$
\end{definition}

\begin{lemma}
	Für einen zulässigen Fluss $f$ sind folgende Aussagen äquivalent:
	\begin{enumerate}[(i)]
		\item Der Fluss $f$ fließt nur entlang aktiver Kanten.
		\item Für jede Kante $uv\in E$ und für alle $\theta\in\R$ gilt $F_{uv}^-(T_{uv}(l_u(\theta)) = F_{uv}^-(l_v(\theta))$.
	\end{enumerate}
\end{lemma}
\begin{proof}
	$(i)\Rightarrow (ii)$: Seien $uv\in E$ und $\theta\in\R$ gegeben.
	Die Beziehung $F_{uv}^-(T_{uv}(l_u(\theta))) \geq F_{uv}^-(l_v(\theta))$ gilt bereits wegen der Monotonie von $F_{uv}^-$ und Lemma~\ref{lemma-dreicksungl}.
	Ist $uv$ aktiv zum Zeitpunkt $\theta$, so ist $T_{uv}(l_u(\theta))=l_v(\theta)$ und die Aussage gilt offensichtlich.
	Sonst ist $l_v(\theta) < T_{uv}(l_u(\theta))$. \todo{nur für fast alle theta}
	Sei $\tilde{\theta}:=\sup\{ \tilde{\theta}\in\R \mid l_v(\theta) \geq T_{uv}(l_u(\tilde{\theta})) \}$ der späteste Startzeitpunkt, sodass man spätestens zum Zeitpunkt $l_v(\theta)$ von $s$ über $uv$ zu $v$ gelangt.
	Man beachte, dass $\tilde{\theta}=-\infty$ gilt, falls solch ein Startzeitpunkt nicht existiert.
	Es ist $\tilde{\theta} \leq \theta$, da $T_{uv}\circ l_u$ monoton wachsend ist und für $\tilde{\theta} > \theta$ wäre $T_{uv}(l_u(\tilde{\theta})) > l_v(\theta)$.
	Wegen der Monotonie von $l_v$ und nach Definition von $\tilde{\theta}$ gilt $l_v(\theta')\leq l_v(\theta)< T_{uv}(l_u(\theta'))$ für $\theta'\in (\tilde{\theta}, \theta]$; insbesondere ist die Kante $uv$ in $\theta'$ nicht aktiv und nach Voraussetzung gilt $f_{uv}^+(l_u(\theta')) = 0$ für $\theta'\in (\tilde{\theta}, \theta]$. \todo{fast alle?}
	Also ist $F_{uv}^+(l_u(\theta)) = F_{uv}^+(l_u(\tilde{\theta}))$. Nach Proposition~\ref{prop-feasible-flow}~(\ref{prop-feasible-flow-det-outflow}) ist dann $F_{uv}^-(T_{uv}(l_u(\theta))) = F_{uv}^-(T_{uv}(l_u(\tilde{\theta}))\leq F_{uv}^-(l_v(\theta))$ wegen Montonie von $F_{uv}^-$ und der Definition von $\tilde{\theta}$.
	
	$(ii) \Rightarrow (i)$: Sei eine Kante $uv\in E$, die zu einem Zeitpunkt $\theta\in\R$ nicht aktiv ist, gegeben.
	Es gilt also $l_v(\theta) < T_{uv}(l_u(\theta))$ und wegen der Stetigkeit von $l_v$ und von $T_{uv}\circ l_u$ existiert ein $\varepsilon\in\R_+$ sodass $l_v(\theta + \varepsilon) < T_{uv}(l_u(\theta - \varepsilon))$ gilt.
	Dann ist 
	$$
	0
	\leq
	\int_{l_u(\theta-\varepsilon)}^{l_u(\theta + \varepsilon)}f_{uv}^+(t) dt
	=
	\int_{T_{uv}(l_u(\theta-\varepsilon))}^{T_{uv}(l_u(\theta+\varepsilon))} f_{uv}^-(t) dt
	\leq
	\int_{l_v(\theta + \varepsilon)}^{T_{uv}(l_u(\theta + \varepsilon))} f_{uv}^-(t) dt
	=
	0,
	$$
	wobei die letzte Gleichung aus der Voraussetzung $F_{uv}^-(l_v(\theta+\varepsilon)) = F_{uv}^-(T_{uv}(l_u(\theta + \varepsilon)))$ gefolgert wird.
	Also ist $f_{uv}^+$ in einer Umgebung um $l_u(\theta)$ fast überall gleich $0$.
	
	Da die Menge aller Zeitpunkte, in denen $uv$ nicht aktiv ist, wegen der Stetigkeit von $l_v$ und $T_{uv}\circ l_u$ eine Vereinigung (abzählbarer) Intervalle ist, genügt es zu zeigen, dass die Bedingung lokal fast immer erfüllt ist.
\end{proof}


blablabla Definition FIFO bla

\begin{definition}
	Für eine Kante $uv\in E$ bezeichne man $x_{uv}^+(\theta):= F_{uv}^+(l_u(\theta))$ als die Flussmenge, die die Kante $uv$ betreten hat, bevor Partikel, die zum Zeitpunkt $\theta$ in $s$ starten, $u$ erreichen können.
	
	Mit $x_{uv}^-(\theta):= F^-_{uv}(l_v(\theta))$ bezeichne man die Flussmenge, die die Kante $uv$ verlassen haben bis Partikel, die zur Zeit $\theta$ in $s$ starten, $v$ erreichen können.
	
	
\end{definition}
